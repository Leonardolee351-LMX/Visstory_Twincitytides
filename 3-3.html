<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 3 - Who Cross the Border</title>
    
    <!-- --- UNIFIED FONTS --- -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;700&family=Noto+Serif+SC:wght@500;700&display=swap" rel="stylesheet">
    
    <!-- --- UNIFIED ICONS (Phosphor Icons) --- -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    
    <!-- JS Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0E7490', // Cyan 700
                        secondary: '#06B6D4', // Cyan 500
                        accent: '#ECFEFF', // Cyan 50
                        slate: { 
                            850: '#1e293b',
                            900: '#0f172a' 
                        },
                        // Emotion colors from demo
                        emotion: {
                            anxiety: '#f43f5e',
                            joy: '#10b981',
                            calm: '#64748b'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                        serif: ['"Noto Serif SC"', 'serif'],
                    },
                    boxShadow: {
                        'glass': '0 10px 30px -10px rgba(14, 116, 144, 0.1)',
                        'glass-hover': '0 20px 40px -10px rgba(14, 116, 144, 0.2)',
                        'inner-groove': 'inset 0 2px 4px 0 rgba(0, 0, 0, 0.06)',
                        'float': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                    }
                }
            }
        }
    </script>

    <style>
        /* GLOBAL RESET & SCROLLBAR */
        body {
            background-color: #f1f5f9;
            color: #0F172A;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
        }

        /* --- NOISE TEXTURE --- */
        .noise-bg {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
            pointer-events: none;
            z-index: 0;
        }

        /* Glassmorphism Utilities */
        .glass-card {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 10px 30px -10px rgba(14, 116, 144, 0.05);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); /* Elastic ease */
        }
        
        .glass-card:hover {
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 20px 40px -12px rgba(14, 116, 144, 0.2);
            border-color: #A5F3FC; /* Cyan-200 */
            transform: translateY(-2px);
        }

        /* --- TIMELINE NEW STYLES --- */
        /* ÊòºÂ§úÊ∏êÂèòËÉåÊôØ */
        .timeline-bg {
            background: linear-gradient(90deg, 
                #f1f5f9 0%,    /* Ê∑±Â§ú - ÊµÖÁÅ∞ */
                #ffffff 10%,   /* ËøáÊ∏° */
                #ffffff 90%,   /* Á∫ØÁôΩ */
                #f1f5f9 100%   /* Ê∑±Â§ú - ÊµÖÁÅ∞ */
            );
            border: 1px solid #cbd5e1;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.02);
        }

        /* Tooltip Êîπ‰∏∫ÁªùÂØπÂÆö‰Ωç */
        .floating-tooltip {
            position: absolute; 
            pointer-events: none;
            z-index: 50;
            transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            opacity: 0;
            transform: translateY(10px);
            backdrop-filter: blur(12px);
        }
        .floating-tooltip.active {
            opacity: 1;
            transform: translateY(0);
        }
        .floating-tooltip::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 6px 6px 0;
            border-style: solid;
            border-color: rgba(15, 23, 42, 0.95) transparent transparent transparent;
        }

        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* ËäÇÁÇπÊñáÂ≠óÊ†∑Âºè */
        .node-label {
            text-shadow: 0 2px 4px rgba(255,255,255,0.8);
            pointer-events: none;
            font-weight: 600;
        }
        .node-icon {
            pointer-events: none;
            font-size: 1.25rem;
            filter: drop-shadow(0 2px 2px rgba(0,0,0,0.1));
        }

        /* Typography Precision */
        .tabular-nums {
            font-variant-numeric: tabular-nums;
        }

        /* Active states for cards */
        .profile-card.active {
            border-color: #06B6D4;
            background: rgba(236, 254, 255, 0.9);
            box-shadow: 0 8px 20px rgba(6, 182, 212, 0.15);
            transform: scale(1.02);
        }

        .chapter-title-overlay {
            position: fixed;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Inter', sans-serif;
            font-size: clamp(6rem, 18vw, 12rem);
            font-weight: 800;
            color: rgba(14, 116, 144, 0.03); 
            z-index: 0;
            pointer-events: none;
            white-space: nowrap;
            line-height: 1;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background-color: rgba(148, 163, 184, 0.5); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background-color: #0E7490; }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: rgba(203, 213, 225, 0.5); }
    </style>
</head>
<body class="bg-slate-50 relative">
    <nav class="fixed top-6 left-1/2 -translate-x-1/2 z-[9999] w-[90%] max-w-2xl">
        <div class="bg-white/70 backdrop-blur-md border border-slate-200/50 shadow-lg rounded-2xl px-6 py-3 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <div class="w-3 h-3 bg-primary rounded-full animate-pulse"></div>
                <span class="text-xs font-bold tracking-widest text-slate-800 uppercase font-mono">NBSB Research</span>
            </div>
            <div class="flex gap-4 md:gap-8">
                <a href="3-1.html" class="nav-link text-sm font-semibold transition-colors hover:text-primary" id="nav-3-1"><span data-zh="Ë∑®Êó∂Á©∫ÂàÜÊûê" data-en="Cross-Temporal Analysis">Ë∑®Êó∂Á©∫ÂàÜÊûê</span></a>
                <a href="3-2.html" class="nav-link text-sm font-semibold transition-colors hover:text-primary" id="nav-3-2"><span data-zh="Áæ§ÂÉèÁ∫™ÂÆû" data-en="Persona">Persona</span></a>
                <a href="3-3.html" class="nav-link text-sm font-semibold transition-colors hover:text-primary" id="nav-timeline"><span data-zh="Ë∑®Â¢ÉÊó∂Èó¥Á∫ø" data-en="Cross-Border Timeline">Ë∑®Â¢ÉÊó∂Èó¥Á∫ø</span></a>
                <a href="4-1future_question.html" class="nav-link text-sm font-semibold transition-colors hover:text-primary" id="nav-future"><span data-zh="Êú™Êù•ËÆÆÈ¢ò" data-en="Future Questions">Êú™Êù•ËÆÆÈ¢ò</span></a>
            </div>
            <button id="lang-toggle" class="text-xs font-semibold px-3 py-1 rounded-lg border border-slate-200 text-slate-600 hover:text-primary">EN</button>
            <button onclick="window.print()" class="hidden md:block text-slate-400 hover:text-slate-600">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9V2h12v7"></path><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path><rect x="6" y="14" width="12" height="8"></rect></svg>
            </button>
        </div>
    </nav>

    <style>
        .nav-link { color: #64748b; position: relative; }
        .nav-link.active, .nav-link:hover { color: #0E7490; }
        .nav-link.active::after, .nav-link:hover::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 100%;
            height: 2px;
            background: #0E7490;
            border-radius: 2px;
        }
        body { animation: fadeInPage 0.8s ease-out; }
        @keyframes fadeInPage { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>

    <script>
        const currentFile = window.location.pathname.split("/").pop();
        if (currentFile === "3-1.html" || currentFile === "") {
            document.getElementById('nav-3-1').classList.add('active');
        } else if (currentFile === "3-2.html") {
            document.getElementById('nav-3-2').classList.add('active');
        } else if (currentFile === "3-3.html" || currentFile === "timeline%20copy.html") {
            document.getElementById('nav-timeline').classList.add('active');
        } else if (currentFile === "4-1future_question.html") {
            document.getElementById('nav-future').classList.add('active');
        }
        let lang = localStorage.getItem('lang') || 'en';
        let updateContent = () => {}; // Placeholder for function defined in DOMContentLoaded

        function applyLang(l) {
            document.querySelectorAll('[data-zh]').forEach(el => {
                const txt = el.getAttribute(l === 'zh' ? 'data-zh' : 'data-en');
                if (txt) el.textContent = txt;
            });
            document.documentElement.lang = l === 'zh' ? 'zh-CN' : 'en';
            const btn = document.getElementById('lang-toggle');
            if (btn) btn.textContent = l === 'zh' ? 'EN' : '‰∏≠Êñá';
            
            // Call dynamic content update
            updateContent(l);
        }
        applyLang(lang);
        const toggle = document.getElementById('lang-toggle');
        if (toggle) {
            toggle.addEventListener('click', () => {
                lang = lang === 'zh' ? 'en' : 'zh';
                localStorage.setItem('lang', lang);
                applyLang(lang);
            });
        }
    </script>

    <!-- Noise Texture Overlay -->
    <div class="noise-bg"></div>

    <div id="view-part3" class="view-container relative z-10 w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- ========================================================================= -->
        <!-- NEW Interactive Timeline Section (Replaced with "Dual City 24h Ethnography") -->
        <!-- ========================================================================= -->
        
        <header class="flex flex-col md:flex-row justify-between items-end mb-8 pl-2 animate-[fadeIn_0.6s_ease-out]">
            <div class="mb-4 md:mb-0">
                <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-white/50 text-slate-500 text-[10px] font-bold tracking-widest uppercase mb-3 border border-slate-200 backdrop-blur-sm">
                    <i class="ph-database text-primary"></i> 24-Hour Ethnography
                </div>
                <h1 class="text-3xl md:text-5xl font-extrabold text-slate-900 tracking-tight mb-3">
                    <span data-zh="ÂèåÂüéËÆ∞Ôºö" data-en="Dual City:">ÂèåÂüéËÆ∞Ôºö</span><span class="text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary" data-zh="24Â∞èÊó∂ÁîüÊ¥ªÊäòÂè†" data-en="24h Folded Life">24Â∞èÊó∂ÁîüÊ¥ªÊäòÂè†</span>
                </h1>
                <p class="font-serif text-slate-500 text-base max-w-2xl leading-relaxed italic">
                    "ÊØèÂ§©60‰∏á‰∫∫Ê¨°ÁöÑÁ©øÊ¢≠Ôºå‰∏ç‰ªÖÊòØÁâ©ÁêÜË∑ùÁ¶ªÁöÑÁßªÂä®ÔºåÊõ¥ÊòØ‰∏§ÁßçÊó∂Èó¥ÂàªÂ∫¶ÁöÑÊäòÂè†„ÄÇ"
                </p>
            </div>
            
            <!-- Legend -->
            <div class="bg-white/80 backdrop-blur px-5 py-2.5 rounded-full flex gap-6 text-[10px] font-bold border border-slate-200 shadow-sm uppercase tracking-wider">
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-rose-500 shadow-[0_0_6px_rgba(244,63,94,0.4)]"></span>
                    <span class="text-slate-500">Anxiety</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_6px_rgba(16,185,129,0.4)]"></span>
                    <span class="text-slate-500">Joy</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-slate-400"></span>
                    <span class="text-slate-500">Routine</span>
                </div>
            </div>
        </header>

        <!-- Visualization Area -->
        <div class="glass-card rounded-[24px] p-2 md:p-4 mb-6 relative overflow-visible group">
            
            <!-- Tooltip Container -->
            <div id="tooltip" class="floating-tooltip bg-slate-900/95 text-white p-4 rounded-xl shadow-2xl border border-slate-700 min-w-[240px] max-w-[300px] text-center">
            </div>
            
            <div id="chart-container" class="w-full overflow-x-auto hide-scrollbar relative timeline-bg rounded-xl cursor-crosshair py-4">
                <!-- Sun/Moon Decor -->
                <div class="absolute top-4 left-4 text-slate-400/30 text-xl"><i class="ph-moon"></i></div>
                <div class="absolute top-4 left-1/2 -translate-x-1/2 text-amber-400/20 text-2xl"><i class="ph-sun"></i></div>
                <div class="absolute top-4 right-4 text-slate-400/30 text-xl"><i class="ph-moon"></i></div>
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div id="dashboard" class="grid grid-cols-1 md:grid-cols-10 gap-6 transition-all duration-500 min-h-[240px] mb-20">
            
            <!-- Time & Status Card -->
            <div class="md:col-span-2 glass-card rounded-[20px] p-6 flex flex-col justify-center items-center text-center relative overflow-hidden group/card">
                <div class="z-10 w-full">
                    <h3 class="font-bold text-slate-400 text-[10px] uppercase tracking-widest mb-4 border-b border-slate-100 pb-2 inline-block px-4">
                        <i class="ph-clock mr-1.5 text-secondary"></i> <span data-zh="ÂΩìÂâçËäÇÁÇπ" data-en="Current Node">Current Node</span>
                    </h3>
                    <div id="dash-time" class="font-mono text-5xl text-slate-800 font-bold mb-2 tracking-tighter">--:--</div>
                    <div id="dash-title" class="font-sans text-lg font-bold text-primary leading-tight mt-1 truncate px-2"><span data-zh="ÁÇπÂáªËäÇÁÇπËØ¶ÊÉÖ" data-en="Click node for details">Click node for details</span></div>
                </div>
                
                <div class="mt-8 z-10 w-full px-2">
                    <div class="flex justify-center gap-2 text-[10px] text-slate-400 mb-2 font-mono font-bold tracking-wide">
                        <span data-zh="È¢ÑËÆ°Êó∂Èó¥" data-en="EST. TIME">EST. TIME</span>
                    </div>
                    <div class="w-full bg-slate-100 rounded-full h-1.5 overflow-hidden mx-auto">
                        <div id="dash-progress" class="bg-gradient-to-r from-primary to-secondary h-1.5 rounded-full transition-all duration-1000 w-0 shadow-[0_0_10px_rgba(6,182,212,0.4)]"></div>
                    </div>
                </div>
                <!-- Subtle Decoration -->
                <div class="absolute -bottom-6 -right-6 w-32 h-32 bg-gradient-to-br from-secondary/5 to-transparent rounded-full blur-2xl pointer-events-none"></div>
            </div>

            <!-- Monologue Card -->
            <div class="md:col-span-5 glass-card rounded-[20px] p-8 relative flex flex-col justify-center items-center text-center border-t-4 border-t-transparent hover:border-t-primary transition-colors">
                <h3 class="absolute top-4 font-bold text-slate-400 text-[10px] uppercase tracking-widest flex items-center gap-2">
                    <span class="w-1.5 h-1.5 rounded-full bg-slate-300"></span> <span data-zh="ÂÜÖÂøÉÁã¨ÁôΩ" data-en="Inner Voice">Inner Voice</span>
                </h3>
                
                <div class="mt-6 flex flex-col items-center gap-4 w-full h-full justify-center">
                    <div id="dash-emoji" class="text-4xl filter drop-shadow-sm grayscale opacity-80 mb-2">üí≠</div>
                    <div class="relative z-10 w-full px-4 overflow-y-auto max-h-[160px] custom-scrollbar">
                        <p id="dash-monologue" class="font-serif text-xl md:text-2xl text-slate-700 italic leading-relaxed font-medium">
                            <span data-zh='"ÊØè‰∏™ËäÇÁÇπËÉåÂêéÔºåÈÉΩËóèÁùÄ‰∏ÄÊÆµÊú™ÊõæËØ¥Âá∫ÁöÑÂøÉÂ£∞..."' data-en='"Behind every node, there is an unspoken voice..."'>"Behind every node, there is an unspoken voice..."</span>
                        </p>
                    </div>
                </div>
                <div class="absolute left-4 top-1/2 -translate-y-1/2 text-8xl text-slate-200 font-serif select-none -z-0 opacity-20">‚Äú</div>
                <div class="absolute right-4 top-1/2 -translate-y-1/2 text-8xl text-slate-200 font-serif select-none -z-0 opacity-20">‚Äù</div>
            </div>

            <!-- Context Card -->
            <div class="md:col-span-3 glass-card rounded-[20px] p-6 flex flex-col items-center text-center bg-slate-50/50">
                <h3 class="font-bold text-slate-400 text-[10px] uppercase tracking-widest mb-6 inline-block border-b border-slate-200 pb-1">
                    <i class="ph-map-pin mr-1.5 text-secondary"></i> <span data-zh="Âú∫ÊôØ‰∏éÊ†áÁ≠æ" data-en="Context & Tags">Context & Tags</span>
                </h3>
                
                <div id="dash-tags" class="flex flex-wrap justify-center content-start gap-2 mb-auto">
                    <span class="px-3 py-1.5 bg-white text-slate-300 rounded-lg text-[10px] border border-slate-100 font-mono shadow-sm"><span data-zh="ÊöÇÊó†Êï∞ÊçÆ" data-en="NO_DATA">NO_DATA</span></span>
                </div>
                
                <div class="mt-6 pt-4 border-t border-slate-200/60 w-full">
                    <p id="dash-context-text" class="text-xs text-slate-500 leading-relaxed font-medium px-2">
                        <span data-zh="Ê≠§Â§ÑÂ∞ÜÊòæÁ§∫ËØ•Âú∫ÊôØ‰∏ãÁöÑË°•ÂÖÖ‰ø°ÊÅØ„ÄÇ" data-en="Supplementary info will be shown here.">Supplementary info will be shown here.</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Next Page Button -->
        <div class="text-center py-12">
            <a href="border_issues.html" class="inline-flex items-center gap-2 px-8 py-3 bg-white border border-slate-200 rounded-full text-slate-600 font-medium shadow-sm hover:shadow-md hover:text-primary hover:border-primary transition-all group">
                <span data-zh="‰∏ã‰∏ÄÈ°µÔºöËæπÁïåÁöÑÊú™Ëß£ÈöæÈ¢ò‰∏éÊú™Êù•" data-en="Next Page: Border‚Äôs Unresolved Challenges and Future">Next Page: Border‚Äôs Unresolved Challenges and Future</span>
                <i class="ph-arrow-right group-hover:translate-x-1 transition-transform"></i>
            </a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- THEME CONFIG ---
            const THEME = {
                primary: '#0E7490',      
                secondary: '#06B6D4',    
                accent: '#22D3EE',
                emotion: {
                    anxiety: '#f43f5e',
                    joy: '#10b981',
                    calm: '#64748b'
                }     
            };

            // --- 1. NEW DATA STRUCTURE (Ethnography) ---
            const EMOTIONS = { ANXIETY: 'anxiety', JOY: 'joy', CALM: 'calm' };
            const COLORS = {
                anxiety: THEME.emotion.anxiety, 
                joy: THEME.emotion.joy,     
                calm: THEME.emotion.calm     
            };

            function tr3(s) {
                const dict = {
                    "Ëµ∑Â∫ä": "Wake Up",
                    "ÊäµËææÂè£Â≤∏": "Arrive at Border",
                    "ËøáÂÖ≥": "Border Crossing",
                    "ÊäµËææÂ≠¶Ê†°": "Arrive at School",
                    "Á¶ªÂºÄÂ≠¶Ê†°": "Leave School",
                    "Ëµ¥Ê∏Ø‰∏äÁè≠": "Work in Hong Kong",
                    "ÊäµËææÂÖ¨Âè∏": "Arrive at Office",
                    "Á¶ªÂºÄÂÖ¨Âè∏": "Leave Office",
                    "Âà∞Ê∏Ø": "Arrive in Hong Kong",
                    "Âá∫Âèë": "Departure",
                    "Ê∂àË¥πÂ®±‰πê": "Consumption & Entertainment",
                    "ÂáÜÂ§áËøîÁ®ã": "Prepare to Return",
                    "Áù°Áú†‰∏çË∂≥": "Sleep Deprivation",
                    "‰π¶ÂåÖË∂ÖÈáç": "Heavy Backpack",
                    "Ë∑®Â¢ÉÊ†°Â∑¥": "Cross-border School Bus",
                    "ËΩ¶ÂÜÖË°•Ëßâ": "Nap on Bus",
                    "Â≠¶Á´•ÈÄöÈÅì": "Student Lane",
                    "Âø´ÈÄüÈÄöÂÖ≥": "Fast Clearance",
                    "È¶ôÊ∏ØÊ†°Âõ≠": "Hong Kong Campus",
                    "ËØ≠Ë®ÄÂàáÊç¢": "Language Switch",
                    "ÊîæÂ≠¶Êó∂Âàª": "After-school Time",
                    "ÂáÜÁÇπÂèëËΩ¶": "On-time Bus",
                    "Ê∑±Âú≥Êó©È´òÂ≥∞": "Shenzhen Rush Hour",
                    "Âè£Â≤∏ÂÅúËΩ¶": "Border Parking",
                    "EÈÄöÈÅì": "E-Channel",
                    "‰ø°Âè∑ÂàáÊç¢": "Signal Switch",
                    "‰∏≠ÁéØ/ÈáëÈíü": "Central/Admiralty",
                    "È´òÂéãËÅåÂú∫": "High-pressure Workplace",
                    "ÂáÜÁÇπ‰∏ãÁè≠": "Leave on Time",
                    "Ëµ∂ËΩ¶Êóè": "Catch-the-train Crowd",
                    "Êã•Êå§ËΩ¶Âé¢": "Crowded Carriage",
                    "ÂõûÈÇÆ‰ª∂": "Reply Emails",
                    "Ê∏ØÂºèÊó©È§ê": "HK-style Breakfast",
                    "‰ªéÂÆπÊó©Êô®": "Leisurely Morning",
                    "ÂèçÂêëÁ©∫ËΩ¶": "Reverse-direction Empty Train",
                    "ÂøÖÊúâÂ∫ß‰Ωç": "Seats Guaranteed",
                    "ÊîØ‰ªòÂàáÊç¢": "Payment Switch",
                    "‰∏ùÊªëÈÄöÂÖ≥": "Smooth Clearance",
                    "ÁßëÊäÄÂõ≠": "Tech Park",
                    "ÂèëÂ±ïÊú∫ÈÅá": "Growth Opportunity",
                    "ËÅöÈ§êÊñáÂåñ": "Dining Culture",
                    "È´òÊÄß‰ª∑ÊØî": "High Cost-performance",
                    "ÊôöÈ´òÂ≥∞": "Evening Rush",
                    "ÁÉüÁÅ´Ê∞î": "Human Warmth",
                    "ÂÆ∂Â∫≠Êó•": "Family Day",
                    "Á©∫ÁÆ±Âá∫Âèë": "Empty Suitcase",
                    "ËΩªÊùæËøáÂÖ≥": "Easy Clearance",
                    "ÊúüÂæÖÁæéÈ£ü": "Anticipate Food",
                    "ÊåâÊë©SPA": "Massage & SPA",
                    "Ë∑®Â¢ÉÁúãÁâô": "Cross-border Dental Care",
                    "Â±±ÂßÜ/Costco": "Sam‚Äôs/Costco",
                    "Êª°ËΩΩËÄåÂΩí": "Loaded Return",
                    "ÊãâÊùÜÁÆ±Â§ßÂÜõ": "Suitcase Crowd",
                    "Âø´‰πêÁöÑÁñ≤ÊÉ´": "Happy Fatigue",
                    "Â∑¥Â£´ÂõûÂÆ∂": "Bus Home",
                    "ÁøªÁúãÁÖßÁâá": "Review Photos"
                };
                return lang === 'en' ? (dict[s] || s) : s;
            }

            const rawData = [
                {
                    id: "student", name: "Ë∑®Â¢ÉÂ≠¶Á´•", nameEn: "Cross-border Student", tag: "ÊØèÊó•ÂæÄËøî", tagEn: "Daily Commute",
                    avatar: "https://api.dicebear.com/7.x/notionists/svg?seed=student&backgroundColor=e0f2fe", 
                    events: [
                        { time: 6.0, label: "Ëµ∑Â∫ä", labelEn: "Wake Up", icon: "‚è∞", emotion: EMOTIONS.ANXIETY, tags: ["‚è∞ Áù°Áú†‰∏çË∂≥", "üéí ‰π¶ÂåÖË∂ÖÈáç"], tagsEn: ["‚è∞ Sleep Deprived", "üéí Heavy Bag"], monologue: "ÈóπÈíüÂìç‰∫ÜÁ¨¨‰∏âÈÅç„ÄÇÂ§©ËøòÊòØÈªëÁöÑÔºåÂ¶àÂ¶àÂ°ûÁªôÊàë‰∏ÄÁõíÁâõÂ•∂ÔºåÂÇ¨ÊàëÂø´ÁÇπÁ©øÈûã„ÄÇ‰π¶ÂåÖÂ•ΩÂÉèÊØîÊò®Â§©Êõ¥Èáç‰∫Ü„ÄÇ", monologueEn: "Alarm rang 3 times. Still dark. Mom gave me milk, urged me to hurry. Backpack feels heavier than yesterday." },
                        { time: 6.75, label: "ÊäµËææÂè£Â≤∏", labelEn: "Arrive at Border", icon: "üöå", emotion: EMOTIONS.CALM, tags: ["üöå Ë∑®Â¢ÉÊ†°Â∑¥", "‚ùÑÔ∏è ËΩ¶ÂÜÖË°•Ëßâ"], tagsEn: ["üöå School Bus", "‚ùÑÔ∏è Napping"], monologue: "Âú®‰øùÂßÜËΩ¶‰∏äË°•‰∫Ü‰∏ÄËßâÔºåË¢´ÂÜ∑Ê∞îÂÜªÈÜí„ÄÇÁ™óÂ§ñÂÖ®ÊòØÁ∫¢Ëâ≤ÁöÑËΩ¶Â∞æÁÅØÔºåÊ∑±Âú≥ÁöÑÊó©Êô®ÊòØ‰ªéËΩ¶ÊµÅÂºÄÂßãÁöÑ„ÄÇ", monologueEn: "Napped on nanny bus, woke up by cold AC. Outside is red tail lights. Shenzhen morning starts with traffic." },
                        { time: 7.25, label: "ËøáÂÖ≥", labelEn: "Crossing", icon: "üõÇ", emotion: EMOTIONS.JOY, tags: ["‚úÖ Â≠¶Á´•ÈÄöÈÅì", "‚ö°Ô∏è Âø´ÈÄüÈÄöÂÖ≥"], tagsEn: ["‚úÖ Student Lane", "‚ö°Ô∏è Fast Pass"], monologue: "ÁÜüÁªÉÂú∞ÊéèÂá∫ËØÅ‰ª∂Ôºå'Êª¥'‰∏ÄÂ£∞ÁßíËøá„ÄÇ‰∏çÁî®ÂÉèÊ∏∏ÂÆ¢ÈÇ£Ê†∑ÊéíÈïøÈòüÔºåËøôÂ§ßÊ¶ÇÊòØÂÅöË∑®Â¢ÉÂ≠¶Á´•ÂîØ‰∏ÄÁöÑÁâπÊùÉ‰∫Ü„ÄÇ", monologueEn: "Skilled at ID check, passed in seconds. No long queues like tourists. The only privilege of being a cross-border student." },
                        { time: 8.0, label: "ÊäµËææÂ≠¶Ê†°", labelEn: "Arrive School", icon: "üè´", emotion: EMOTIONS.JOY, tags: ["üè´ È¶ôÊ∏ØÊ†°Âõ≠", "üó£Ô∏è ËØ≠Ë®ÄÂàáÊç¢"], tagsEn: ["üè´ HK Campus", "üó£Ô∏è Lang Switch"], monologue: "Áªà‰∫éÂà∞‰∫Ü„ÄÇÊç¢‰∏äÂπø‰∏úËØùÈ¢ëÈÅìÔºåÂíåÂêåÂ≠¶‰∫§Êç¢Êò®ÊôöÊ≤°ÁúãÂÆåÁöÑÊº´Áîª„ÄÇËøô‰∏ÄÂàªÔºåÊó©Ëµ∑ÁöÑÁóõËã¶Â•ΩÂÉèÊ∂àÂ§±‰∫Ü„ÄÇ", monologueEn: "Finally here. Switch to Cantonese mode, swap comics with classmates. Early morning pain seems gone." },
                        { time: 15.5, label: "Á¶ªÂºÄÂ≠¶Ê†°", labelEn: "Leave School", icon: "üëã", emotion: EMOTIONS.JOY, tags: ["üëã ÊîæÂ≠¶Êó∂Âàª", "üöå ÂáÜÁÇπÂèëËΩ¶"], tagsEn: ["üëã After School", "üöå On Time"], monologue: "ÊîæÂ≠¶ÈíüÂ£∞ÂìçËµ∑ÔºÅËôΩÁÑ∂ÊÉ≥ÁïôÂú®Â≠¶Ê†°Ë∏¢ÁêÉÔºå‰ΩÜÂ¶ÇÊûú‰∏çËµ∂ËøôÁè≠ËΩ¶ÔºåÂõûÂÆ∂Â∞±Ë¶ÅÊë∏Èªë‰∫Ü„ÄÇÂÜçËßÅÔºåÈ¶ôÊ∏Ø„ÄÇ", monologueEn: "School bell! Wanted to play soccer, but must catch the bus or go home in dark. Bye Hong Kong." },
                        { time: 16.5, label: "ÊäµËææÂè£Â≤∏", labelEn: "Arrive Border", icon: "üåâ", emotion: EMOTIONS.CALM, tags: ["üåâ Ê∑±Âú≥Êπæ", "üç™ Èõ∂È£üÊó∂Èó¥"], tagsEn: ["üåâ Shenzhen Bay", "üç™ Snack Time"], monologue: "ËΩ¶‰∏äÂ§ßÂÆ∂ÈÉΩÂú®ÂèëÂëÜÊàñÂêÉÈõ∂È£ü„ÄÇÁúãÁùÄÁ™óÂ§ñÁöÑÂ§ïÈò≥ÁÖßÂú®Ê∑±Âú≥ÊπæÂ§ßÊ°•‰∏äÔºåÊàëÁü•ÈÅìÁ¶ªÂÆ∂Ëøë‰∫ÜÔºåÁ¶ªË°•‰π†Áè≠‰πüËøë‰∫Ü„ÄÇ", monologueEn: "Everyone staring blankly or eating snacks on bus. Sunset on Shenzhen Bay Bridge means home is near, so is tutoring." }
                    ]
                },
                {
                    id: "worker_sz", name: "Ëµ¥Ê∏Ø‰∏äÁè≠", nameEn: "HK Worker in SZ", tag: "ÁâπÁßçÂÖµ", tagEn: "Commuter",
                    avatar: "https://api.dicebear.com/7.x/notionists/svg?seed=Felix&backgroundColor=ffedd5",
                    events: [
                        { time: 6.5, label: "Ëµ∑Â∫ä", labelEn: "Wake Up", icon: "üåÖ", emotion: EMOTIONS.CALM, tags: ["üåÖ ÈîôÂ≥∞Âá∫Ë°å", "‚òïÔ∏è Êô®Èó¥ÂíñÂï°"], tagsEn: ["üåÖ Off-peak", "‚òïÔ∏è Morning Coffee"], monologue: "‰∏∫‰∫ÜÈÅøÂºÄÂ≠¶Á´•Â§ßÂÜõÔºåÂøÖÈ°ªËøô‰∏™ÁÇπËµ∑„ÄÇÂú®Ëøô‰∏™ÂüéÂ∏ÇÈÜíÊù•ÔºåÂéªÂè¶‰∏Ä‰∏™ÂüéÂ∏ÇËµöÈí±„ÄÇËøôÂ∑≤ÊòØÁ¨¨500Â§©ÁöÑÊó•Â∏∏„ÄÇ", monologueEn: "Must wake up now to avoid student rush. Wake up in this city, earn money in another. 500th day of this routine." },
                        { time: 7.25, label: "ÊäµËææÂè£Â≤∏", labelEn: "Arrive Border", icon: "üöá", emotion: EMOTIONS.ANXIETY, tags: ["üöá Ê∑±Âú≥Êó©È´òÂ≥∞", "üöó Âè£Â≤∏ÂÅúËΩ¶"], tagsEn: ["üöá SZ Rush Hour", "üöó Parking"], monologue: "ÊääËΩ¶ÂÅúÂú®Ê∑±Âú≥ÊπæÔºåÊàñËÄÖÊå§‰∏ä4Âè∑Á∫ø„ÄÇÂ§ßÂÆ∂ÈÉΩË°åËâ≤ÂåÜÂåÜÔºåÊ≤°‰∫∫ËØ¥ËØùÔºåÁ©∫Ê∞îÈáåÂº•Êº´ÁùÄË±ÜÊµÜÂë≥ÂíåÁÑ¶ËôëÊÑü„ÄÇ", monologueEn: "Park at Shenzhen Bay or squeeze into Line 4. Everyone rushing, silent, air smells of soy milk and anxiety." },
                        { time: 7.75, label: "ËøáÂÖ≥", labelEn: "Crossing", icon: "‚úÖ", emotion: EMOTIONS.JOY, tags: ["‚úÖ EÈÄöÈÅì", "üì∂ ‰ø°Âè∑ÂàáÊç¢"], tagsEn: ["‚úÖ E-Channel", "üì∂ Signal Switch"], monologue: "EÈÄöÈÅìÊ≤°‰∫∫ÊéíÈòüÔºåËàíÊúçÔºÅË∑®ËøáÈÇ£Êù°Á∫øÔºåÊâãÊú∫‰ø°Âè∑‰ªéÁßªÂä®ÂàáÂà∞CSLÔºåÂæÆ‰ø°ÈùôÈü≥ÔºåWhatsAppÂºÄÂßãÂìç‰∏™‰∏çÂÅú„ÄÇ", monologueEn: "E-Channel empty, nice! Cross the line, signal switches to CSL, WeChat mutes, WhatsApp starts buzzing." },
                        { time: 9.0, label: "ÊäµËææÂÖ¨Âè∏", labelEn: "Arrive Office", icon: "üèôÔ∏è", emotion: EMOTIONS.ANXIETY, tags: ["üíº ‰∏≠ÁéØ/ÈáëÈíü", "üèôÔ∏è È´òÂéãËÅåÂú∫"], tagsEn: ["üíº Central/Admiralty", "üèôÔ∏è High Pressure"], monologue: "‰ªé‰∏≠ÁéØÁ´ôÂá∫Êù•ÔºåËûçÂÖ•Ë•øË£ÖÈù©Â±•ÁöÑ‰∫∫ÊΩÆ„ÄÇ‰π∞ÊùØ40Ê∏ØÂ∏ÅÁöÑÂíñÂï°ÔºåÊ∑±Âê∏‰∏ÄÂè£Ê∞îÔºåÂºÄÂßãÈ´òÂº∫Â∫¶ÁöÑÊàòÊñó„ÄÇ", monologueEn: "Exit Central station, merge into suits crowd. Buy HK$40 coffee, deep breath, start high-intensity battle." },
                        { time: 18.0, label: "Á¶ªÂºÄÂÖ¨Âè∏", labelEn: "Leave Office", icon: "üåô", emotion: EMOTIONS.CALM, tags: ["üåô ÂáÜÁÇπ‰∏ãÁè≠", "üèÉ Ëµ∂ËΩ¶Êóè"], tagsEn: ["üåô Leave on Time", "üèÉ Rushing"], monologue: "Áªà‰∫éÂêà‰∏äÁîµËÑë„ÄÇÂêå‰∫ã‰ª¨ËøòÂú®Âä†Áè≠Ôºå‰ΩÜÊàëÂøÖÈ°ªËµ∞‰∫Ü„ÄÇÁÅ∞ÂßëÂ®òÁöÑÊ∞¥Êô∂ÈûãÊòØÊúâÊó∂ÊïàÁöÑÔºåÊàëÁöÑÊó∂ÊïàÊòØÊú´Áè≠ËΩ¶„ÄÇ", monologueEn: "Laptop closed. Colleagues still working, but I must go. Cinderella's magic fades, mine is the last train." },
                        { time: 19.0, label: "ÊäµËææÂè£Â≤∏", labelEn: "Arrive Border", icon: "üêü", emotion: EMOTIONS.ANXIETY, tags: ["üêü Êã•Êå§ËΩ¶Âé¢", "üìß ÂõûÈÇÆ‰ª∂"], tagsEn: ["üêü Crowded", "üìß Replying Email"], monologue: "ÈáëÈíüÂà∞ËêΩÈ©¨Ê¥≤ÁöÑËΩ¶Âé¢Ê∞∏ËøúÂÉèÊ≤ô‰∏ÅÈ±ºÁΩêÂ§¥„ÄÇÁªÉÂ∞±‰∫ÜÂçïÊâãÊäìÊâ∂Êâã„ÄÅÂçïÊâãÂõûÈÇÆ‰ª∂ÁöÑÊú¨‰∫ã„ÄÇËÄ≥Êú∫ÈáåÊí≠ÂÆ¢ÁöÑÂ£∞Èü≥ÊòØÂîØ‰∏ÄÁöÑÊÖ∞Ëóâ„ÄÇ", monologueEn: "Admiralty to Lok Ma Chau is always packed like sardines. Mastered one-hand rail holding, one-hand email replying. Podcast is the only comfort." }
                    ]
                },
                {
                    id: "worker_hk", name: "ÁïôÊ∏ØÁ°ïÂ£´", nameEn: "SZ Worker in HK", tag: "Ê∑±ÈÄ†ÈïÄÈáë", tagEn: "Career Seeker",
                    avatar: "https://api.dicebear.com/7.x/notionists/svg?seed=Aneka&backgroundColor=d1fae5",
                    events: [
                        { time: 7.5, label: "Ëµ∑Â∫ä", labelEn: "Wake Up", icon: "üç≥", emotion: EMOTIONS.JOY, tags: ["üç≥ Ê∏ØÂºèÊó©È§ê", "üòå ‰ªéÂÆπÊó©Êô®"], tagsEn: ["üç≥ HK Breakfast", "üòå Leisure Morning"], monologue: "ÂèØ‰ª•Âú®Ëå∂È§êÂéÖÊÖ¢ÊÇ†ÊÇ†ÂêÉ‰∏™AÈ§êÂÜçÂá∫Âèë„ÄÇÁúãÁùÄÂØπÈù¢ÊúàÂè∞Êå§Êª°ÂéªÊ∏ØÂ≤õÁöÑ‰∫∫ÔºåÂøÉÈáåÊöóËá™Â∫ÜÂπ∏ÊàëÊòØ'ÈÄÜË°åËÄÖ'„ÄÇ", monologueEn: "Slowly enjoy Set A breakfast at Cha Chaan Teng. Watching crowded platform opposite, glad I'm a 'reverse commuter'." },
                        { time: 8.25, label: "ÊäµËææÂè£Â≤∏", labelEn: "Arrive Border", icon: "üöÑ", emotion: EMOTIONS.JOY, tags: ["üöÑ ÂèçÂêëÁ©∫ËΩ¶", "üí∫ ÂøÖÊúâÂ∫ß‰Ωç"], tagsEn: ["üöÑ Empty Train", "üí∫ Guaranteed Seat"], monologue: "Âùê‰∏úÈìÅÁ∫øÂåó‰∏äÔºåËΩ¶Âé¢Á©∫Ëç°Ëç°ÔºåÁîöËá≥ÂèØ‰ª•Êåë‰∏™Èù†Á™óÁöÑ‰ΩçÁΩÆÁúãÈ£éÊôØ„ÄÇËøôÂ∞±ÊòØÂèçÂêëÈÄöÂã§ÁöÑÂø´‰πê„ÄÇ", monologueEn: "Northbound East Rail Line, empty carriage, picked window seat. Joy of reverse commute." },
                        { time: 8.5, label: "ËøáÂÖ≥", labelEn: "Crossing", icon: "üõÇ", emotion: EMOTIONS.JOY, tags: ["üì± ÊîØ‰ªòÂàáÊç¢", "üõÇ ‰∏ùÊªëÈÄöÂÖ≥"], tagsEn: ["üì± Payment Switch", "üõÇ Smooth Entry"], monologue: "Ëµ∞È¶ôÊ∏ØÂ±ÖÊ∞ëÈÄöÈÅìÔºå‰∏ùÊªëÂÖ•Â¢ÉÊ∑±Âú≥„ÄÇÊääÈí±ÂåÖÊî∂Ëµ∑Êù•ÔºåÊéèÂá∫ÊâãÊú∫ÊâìÂºÄÊîØ‰ªòÂÆù/ÂæÆ‰ø°ÔºåÂàáÊç¢ÊàêÂÜÖÂú∞ÁîüÂ≠òÊ®°Âºè„ÄÇ", monologueEn: "HK Resident channel, smooth entry to SZ. Hide wallet, open Alipay/WeChat, switch to Mainland survival mode." },
                        { time: 9.0, label: "ÊäµËææÂÖ¨Âè∏", labelEn: "Arrive Office", icon: "üíª", emotion: EMOTIONS.CALM, tags: ["üíª ÁßëÊäÄÂõ≠", "üöÄ ÂèëÂ±ïÊú∫ÈÅá"], tagsEn: ["üíª Tech Park", "üöÄ Opportunity"], monologue: "ÂçóÂ±±ÁßëÊäÄÂõ≠ÔºåÂÖ®ÊòØÁéªÁíÉÂπïÂ¢ôÂíåÂπ¥ËΩª‰∫∫„ÄÇËôΩÁÑ∂Â∑•ËµÑË¥¶Èù¢Â∞ëÁÇπÔºå‰ΩÜËøôÈáåÊúâÂçà‰ºëÂ∫äÔºåËøòÊúâÊõ¥ÂπøÈòîÁöÑ‰∏äÂçáÁ©∫Èó¥„ÄÇ", monologueEn: "Nanshan Tech Park, glass walls and young people. Lower salary on paper, but nap beds and wider growth space." },
                        { time: 18.0, label: "Á¶ªÂºÄÂÖ¨Âè∏", labelEn: "Leave Office", icon: "üç≤", emotion: EMOTIONS.JOY, tags: ["üç≤ ËÅöÈ§êÊñáÂåñ", "üí∞ È´òÊÄß‰ª∑ÊØî"], tagsEn: ["üç≤ Dining Culture", "üí∞ High Value"], monologue: "‰∏ãÁè≠‰∏çÊÄ•ÁùÄÂõûÈ¶ôÊ∏Ø„ÄÇÂêå‰∫ãÂêÜÂñùÁùÄÂéªÂêÉÊ§∞Â≠êÈ∏°ÔºåËøô‰∏ÄÈîÖÂú®È¶ôÊ∏ØË¶ÅÂçñ300ÔºåËøôÈáåÂè™Ë¶Å100Âá∫Â§¥„ÄÇËµ∞Ëµ∑ÔºÅ", monologueEn: "No rush to return. Colleagues going for Coconut Chicken, HK$100 here vs HK$300 there. Let's go!" },
                        { time: 19.0, label: "ÊäµËææÂè£Â≤∏", labelEn: "Arrive Border", icon: "üöá", emotion: EMOTIONS.CALM, tags: ["üöá ÊôöÈ´òÂ≥∞", "üèôÔ∏è ÁÉüÁÅ´Ê∞î"], tagsEn: ["üöá Evening Rush", "üèôÔ∏è Human Warmth"], monologue: "Â∏¶ÁùÄ‰∏ÄË∫´ÁÅ´ÈîÖÂë≥ÂùêÂú∞ÈìÅÂéªÂè£Â≤∏„ÄÇÊ∑±Âú≥ÁöÑÊôöÈ´òÂ≥∞‰πüÂæàÂ†µÔºå‰ΩÜÁõ∏ÊØîÈ¶ôÊ∏ØÁöÑÂÜ∑Êº†ÔºåËøôÈáåÂ§ö‰∫ÜÁÇπÁÉüÁÅ´Ê∞î„ÄÇ", monologueEn: "Smelling of hotpot on subway to border. Shenzhen evening rush is jammed, but unlike HK's coldness, here has human warmth." }
                    ]
                },
                {
                    id: "consumer", name: "Âåó‰∏äÊ∂àË¥π", nameEn: "NB Consumer", tag: "Âë®Êú´Êâ´Ë¥ß", tagEn: "Shopping",
                    avatar: "https://api.dicebear.com/7.x/notionists/svg?seed=Grandma&backgroundColor=fee2e2",
                    events: [
                        { time: 9.0, label: "Âá∫Âèë", labelEn: "Departure", icon: "üß≥", emotion: EMOTIONS.JOY, tags: ["üë®‚Äçüë©‚Äçüëß‚Äçüë¶ ÂÆ∂Â∫≠Êó•", "üß≥ Á©∫ÁÆ±Âá∫Âèë"], tagsEn: ["üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Day", "üß≥ Empty Suitcase"], monologue: "Âë®Êú´Áù°Âà∞Ëá™ÁÑ∂ÈÜí„ÄÇÂÖ®ÂÆ∂Âá∫Âä®ÔºÅËøôÂë®ÁöÑÁõÆÊ†áÊòØÂ±±ÂßÜË∂ÖÂ∏ÇÂíåÈÇ£ÂÆ∂Êñ∞ÂºÄÁöÑÈÖ∏ËèúÈ±º„ÄÇÂ∏¶‰∏äÈÇ£‰∏™ÊúÄÂ§ßÁöÑÊãâÊùÜÁÆ±„ÄÇ", monologueEn: "Slept in. Family outing! Target: Sam's Club and new Sauerkraut Fish place. Bring the biggest suitcase." },
                        { time: 10.0, label: "ËøáÂÖ≥", labelEn: "Crossing", icon: "üòã", emotion: EMOTIONS.JOY, tags: ["üõÇ ËΩªÊùæËøáÂÖ≥", "üòã ÊúüÂæÖÁæéÈ£ü"], tagsEn: ["üõÇ Easy Pass", "üòã Expecting Food"], monologue: "ËôΩÁÑ∂Ëé≤Â°òÂè£Â≤∏‰∫∫‰πü‰∏çÂ∞ëÔºå‰ΩÜÂ§ßÂÆ∂ËÑ∏‰∏äÈÉΩÂÜôÁùÄÊúüÂæÖ„ÄÇÁúãÂà∞'Ê∑±Âú≥Ê¨¢ËøéÊÇ®'ÁöÑÂ§ßÂ≠óÔºåËÉÉÂè£Â∑≤ÁªèÊâìÂºÄ‰∫Ü„ÄÇ", monologueEn: "Liantang port crowded, but everyone looks expectant. Seeing 'Welcome to Shenzhen', appetite is already open." },
                        { time: 11.0, label: "Ê∂àË¥πÂ®±‰πê", labelEn: "Entertainment", icon: "üíÜ", emotion: EMOTIONS.JOY, tags: ["üíÜ ÊåâÊë©SPA", "ü¶∑ Ë∑®Â¢ÉÁúãÁâô"], tagsEn: ["üíÜ Massage SPA", "ü¶∑ Dental Care"], monologue: "ËøôÊòØ‰ªÄ‰πàÁ•û‰ªôÁâ©‰ª∑ÔºÅÊåâÊë©Âè™Ë¶ÅÈ¶ôÊ∏ØÁöÑ‰∏âÂàÜ‰πã‰∏ÄÔºåÊúçÂä°ËøòËøô‰πàÂ•Ω„ÄÇËÄÅÂ©ÜÂéªÂÅöÁæéÁî≤‰∫ÜÔºåÊàëÊ≠£Â•ΩÂéªÊ¥ó‰∏™Áâô„ÄÇ", monologueEn: "Godly prices! Massage 1/3 of HK price, great service. Wife doing nails, I'm cleaning teeth." },
                        { time: 21.0, label: "ÂáÜÂ§áËøîÁ®ã", labelEn: "Return Prep", icon: "üõí", emotion: EMOTIONS.CALM, tags: ["üõí Â±±ÂßÜ/Costco", "üõçÔ∏è Êª°ËΩΩËÄåÂΩí"], tagsEn: ["üõí Sam's/Costco", "üõçÔ∏è Fully Loaded"], monologue: "ËøôÂ∞±ÊòØ‰º†ËØ¥‰∏≠ÁöÑ‰ªìÂÇ®Ë∂ÖÂ∏ÇÂêóÔºüÂ∑®Â§ßÁöÑÁÉ§È∏°„ÄÅÊàêÂ±±ÁöÑËçâËéì„ÄÇÊãâÊùÜÁÆ±Â∑≤ÁªèÂ°û‰∏ç‰∏ã‰∫ÜÔºåÊâãÈáåËøòÊèêÁùÄ‰∏§Ë¢ã„ÄÇ", monologueEn: "Legendary warehouse supermarket? Giant roast chicken, mountains of strawberries. Suitcase full, carrying two bags." },
                        { time: 22.0, label: "ËøáÂÖ≥", labelEn: "Crossing", icon: "üò´", emotion: EMOTIONS.ANXIETY, tags: ["üì¶ ÊãâÊùÜÁÆ±Â§ßÂÜõ", "üò´ Âø´‰πêÁöÑÁñ≤ÊÉ´"], tagsEn: ["üì¶ Suitcase Army", "üò´ Happy Tired"], monologue: "Â§ßÂÆ∂ÈÉΩÊåëËøô‰∏™ÁÇπÂõûÂéª„ÄÇÂè£Â≤∏ÂÖ®ÊòØÊãñÁùÄÁÆ±Â≠êÁöÑ‰∫∫ÔºåÂÉèÊò•Ëøê‰∏ÄÊ†∑„ÄÇËÖøÂ•ΩÈÖ∏Ôºå‰ΩÜÁúãÁùÄËøô‰∏ÄÂ†ÜÊàòÂà©ÂìÅÔºåÂÄº‰∫ÜÔºÅ", monologueEn: "Everyone leaving now. Border full of suitcases. Legs sore, but seeing the loot, worth it!" },
                        { time: 22.5, label: "Âà∞Ê∏Ø", labelEn: "Arrive HK", icon: "üöå", emotion: EMOTIONS.JOY, tags: ["üöå Â∑¥Â£´ÂõûÂÆ∂", "üì∏ ÁøªÁúãÁÖßÁâá"], tagsEn: ["üöå Bus Home", "üì∏ Photos"], monologue: "Âùê‰∏äÂõûÂÆ∂ÁöÑÂ∑¥Â£´ÔºåÁøªÁúã‰ªäÂ§©ÁöÑÁÖßÁâá„ÄÇÂê¨ËØ¥‰∏áË±°ÂüéÂèàÂºÄ‰∫ÜÊñ∞Â∫óÔºå‰∏ãÂë®ËøòË¶ÅÂÜçÊù•„ÄÇ", monologueEn: "On bus home, browsing photos. Heard MixC opened new shops, coming back next week." }
                    ]
                }
            ];

            rawData.forEach(p => {
                p.events = p.events.filter(e => e.time >= 5 && e.time <= 22);
            });

            // --- 2. D3 RENDER LOGIC ---
            function renderTimeline() {
                const container = d3.select("#chart-container");
                const containerNode = document.getElementById("chart-container");
                // Dynamic width based on container, ensuring min width for scroll
                const width = Math.max(containerNode.clientWidth, 1200); 
                const height = 480; 
                const margin = { top: 70, right: 60, bottom: 40, left: 100 };

                // Clear existing SVG if any
                container.selectAll("svg").remove();

                const svg = container.append("svg")
                    .attr("id", "timeline-svg")
                    .attr("width", width)
                    .attr("height", height);

                // Scales
                const xScale = d3.scaleLinear().domain([5, 22]).range([margin.left, width - margin.right]);
                const yScale = d3.scalePoint().domain(rawData.map(d => d.id)).range([margin.top, height - margin.bottom]).padding(0.7);

                // --- 3. TIMELINE AXIS ---
                const allHours = d3.range(5, 23);
                const majorHours = [5, 8, 12, 16, 20, 22]; 

                const axisGroup = svg.append("g");

                allHours.forEach(h => {
                    const isMajor = majorHours.includes(h);
                    const xPos = xScale(h);
                    
                    // Ticks
                    axisGroup.append("line")
                        .attr("x1", xPos).attr("x2", xPos)
                        .attr("y1", margin.top - (isMajor ? 12 : 6)) 
                        .attr("y2", margin.top)
                        .attr("stroke", isMajor ? "#94a3b8" : "#cbd5e1")
                        .attr("stroke-width", isMajor ? 1.5 : 1);

                    // Grid lines
                    if (isMajor) {
                        axisGroup.append("line")
                            .attr("x1", xPos).attr("x2", xPos)
                            .attr("y1", margin.top).attr("y2", height - margin.bottom)
                            .attr("stroke", "#94a3b8").attr("stroke-opacity", 0.1)
                            .attr("stroke-dasharray", "4 4");
                    }

                    // Time Labels
                    axisGroup.append("text")
                        .attr("x", xPos)
                        .attr("y", margin.top - (isMajor ? 18 : 12))
                        .attr("text-anchor", "middle")
                        .attr("class", `font-mono ${isMajor ? 'text-sm font-bold fill-slate-600' : 'text-[10px] fill-slate-400'} tabular-nums`)
                        .text(`${h}:00`);
                });

                // --- 4. SWIMLANES & TRACKS ---
                const swimlanes = svg.selectAll(".swimlane")
                    .data(rawData).enter().append("g");

                rawData.forEach(person => {
                    // Background Track
                    svg.append("rect")
                        .attr("x", xScale(5))
                        .attr("y", yScale(person.id) - 3)
                        .attr("width", xScale(22) - xScale(5))
                        .attr("height", 6)
                        .attr("rx", 3)
                        .attr("fill", "#f1f5f9"); 

                    // Event Segments
                    for(let i = 0; i < person.events.length - 1; i++) {
                        const curr = person.events[i];
                        const next = person.events[i+1];
                        const startX = xScale(curr.time);
                        const endX = xScale(next.time);
                        const y = yScale(person.id);
                        
                        const colorMap = {
                            'anxiety': 'rgba(244, 63, 94, 0.4)', 
                            'joy': 'rgba(16, 185, 129, 0.4)',     
                            'calm': 'rgba(100, 116, 139, 0.4)'   
                        };

                        svg.append("rect")
                            .attr("x", startX)
                            .attr("y", y - 3)
                            .attr("width", endX - startX)
                            .attr("height", 6) 
                            .attr("rx", 3)
                            .attr("fill", colorMap[curr.emotion])
                            .attr("class", "transition-opacity hover:opacity-100 opacity-80");
                    }
                });

                // Headers (Avatars & Names)
                const headers = swimlanes.append("g")
                    .attr("transform", d => `translate(10, ${yScale(d.id)})`); 
                
                headers.append("defs").append("clipPath")
                    .attr("id", d => `clip-${d.id}`)
                    .append("circle").attr("cx", 24).attr("cy", 0).attr("r", 24);
                
                headers.append("circle")
                    .attr("cx", 24).attr("cy", 0).attr("r", 26)
                    .attr("fill", "white")
                    .attr("stroke", "#e2e8f0")
                    .attr("stroke-width", 2);

                headers.append("image")
                    .attr("xlink:href", d => d.avatar)
                    .attr("x", 0).attr("y", -24)
                    .attr("width", 48).attr("height", 48)
                    .attr("clip-path", d => `url(#clip-${d.id})`);

                const labelGroup = headers.append("g").attr("transform", "translate(60, -8)");
                
                labelGroup.append("text")
                    .attr("class", "header-name font-sans font-bold text-sm fill-slate-800")
                    .text(d => lang === 'en' ? (d.nameEn || d.name) : d.name);

                labelGroup.append("rect")
                    .attr("y", 6)
                    .attr("width", 64).attr("height", 18)
                    .attr("rx", 4)
                    .attr("fill", "#f1f5f9")
                    .attr("stroke", "#e2e8f0");
                
                labelGroup.append("text")
                    .attr("x", 32).attr("y", 18)
                    .attr("text-anchor", "middle")
                    .attr("class", "header-tag font-mono text-[9px] fill-slate-500 font-bold uppercase tracking-wide")
                    .text(d => lang === 'en' ? (d.tagEn || d.tag) : d.tag);


                // --- 5. INTERACTIVE NODES ---
                const tooltip = document.getElementById('tooltip');

                rawData.forEach(person => {
                    const group = svg.append("g");
                    const nodes = group.selectAll(".node")
                        .data(person.events).enter().append("g")
                        .attr("class", "node cursor-pointer group")
                        .attr("transform", d => `translate(${xScale(d.time)}, ${yScale(person.id)})`);

                    // Node Circle
                    nodes.append("circle")
                        .attr("r", 6)
                        .attr("fill", d => COLORS[d.emotion])
                        .attr("stroke", "white")
                        .attr("stroke-width", 2)
                        .attr("class", "shadow-sm transition-all duration-300 group-hover:scale-150 group-hover:stroke-4");

                    // Icon (Above)
                    nodes.append("text")
                        .attr("y", -18) 
                        .attr("text-anchor", "middle")
                        .attr("class", "node-icon text-xl") 
                        .text(d => d.icon);

                    // Label (Below, staggered)
                    nodes.append("text")
                        .attr("y", (d, i) => 22 + (i % 2) * 12)
                        .attr("text-anchor", "middle")
                        .attr("class", "node-label font-sans text-[10px] font-bold fill-slate-400 group-hover:fill-primary transition-colors")
                        .text(d => lang === 'en' ? (d.labelEn || d.label) : d.label);

                    // Events
                    nodes
                        .on("mouseenter", function(event, d) {
                            const cx = xScale(d.time); 
                            const cy = yScale(person.id); 
                            
                            const tagsList = lang === 'en' ? (d.tagsEn || d.tags) : d.tags;
                            const cleanTags = tagsList.map(t => t.replace(/[\[\]]/g, ''));
                            const mono = lang === 'en' ? (d.monologueEn || d.monologue) : d.monologue;
                            const shortMono = mono.substring(0, 35) + (mono.length > 35 ? '...' : '');
                            const labelText = lang === 'en' ? (d.labelEn || d.label) : d.label;

                            tooltip.innerHTML = `
                                <div class="flex flex-col items-center gap-2">
                                    <div class="text-xs font-mono text-slate-400 font-bold tracking-wider border-b border-slate-700 pb-1 mb-1">${formatTime(d.time)}</div>
                                    <div class="text-sm font-bold text-white">${labelText}</div>
                                    <div class="text-[10px] text-slate-300 italic leading-tight px-2">"${shortMono}"</div>
                                    <div class="flex gap-1 flex-wrap justify-center mt-1">
                                        ${cleanTags.map(t => `<span class="px-2 py-0.5 bg-slate-700 rounded text-[9px] text-cyan-200 border border-slate-600 shadow-sm">${t}</span>`).join('')}
                                    </div>
                                </div>
                            `;
                            
                            tooltip.classList.add('active');

                            const tooltipRect = tooltip.getBoundingClientRect();
                            const tooltipWidth = tooltipRect.width;
                            const tooltipHeight = tooltipRect.height;

                            let leftPos = cx;
                            let topPos = cy - tooltipHeight - 30; 
                            
                            // NOTE: Adjusting for scrolling container coordinates relative to viewport is complex here
                            // Simplification: Showing tooltip relative to node's visual position inside SVG
                            // For a scrollable SVG inside a div, using event.layerX/Y is better or fixed positioning logic
                            // Here we use simple offset from the SVG element
                            
                            // Correction: Since chart-container is scrollable relative, we need to map svg coords to tooltip absolute coords
                            // But tooltip is absolute inside relative container? Yes in HTML structure above.
                            
                            if (leftPos - tooltipWidth/2 < 10) leftPos = tooltipWidth/2 + 10;
                            if (leftPos + tooltipWidth/2 > width - 10) leftPos = width - tooltipWidth/2 - 10;

                            tooltip.style.left = `${leftPos - tooltipWidth/2}px`;
                            tooltip.style.top = `${topPos}px`;
                        })
                        .on("mouseleave", function() {
                            tooltip.classList.remove('active');
                        })
                        .on("click", function(event, d) {
                            updateDashboard(d);
                        });
                });

                // Cursor Line
                const cursorLine = svg.append("line")
                    .attr("class", "cursor-line")
                    .attr("y1", margin.top).attr("y2", height - margin.bottom)
                    .attr("stroke", "#0E7490")
                    .attr("stroke-width", 1.5)
                    .attr("stroke-dasharray", "4 4")
                    .style("opacity", 0);

                svg.on("mousemove", function(event) {
                    const [mx] = d3.pointer(event);
                    if (mx < margin.left || mx > width - margin.right) {
                        cursorLine.style("opacity", 0); return;
                    }
                    cursorLine.attr("x1", mx).attr("x2", mx).style("opacity", 1);
                }).on("mouseleave", () => cursorLine.style("opacity", 0));
            }

            // --- 6. HELPERS & DASHBOARD UPDATE ---
            function formatTime(timeVal) {
                const h = Math.floor(timeVal);
                const m = Math.round((timeVal - h) * 60);
                return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
            }

            function updateDashboard(d) {
                // Time
                document.getElementById('dash-time').textContent = formatTime(d.time);
                // Title
                document.getElementById('dash-title').textContent = `${lang==='en' ? (d.labelEn || d.label) : d.label}`;
                
                // Progress Bar
                const bar = document.getElementById('dash-progress');
                bar.style.width = `100%`;
                
                const colorClass = {
                    'anxiety': 'bg-rose-500 shadow-[0_0_10px_rgba(244,63,94,0.4)]',
                    'joy': 'bg-emerald-500 shadow-[0_0_10px_rgba(16,185,129,0.4)]',
                    'calm': 'bg-slate-400 shadow-[0_0_10px_rgba(148,163,184,0.4)]'
                };
                bar.className = `h-1.5 rounded-full transition-all duration-500 ${colorClass[d.emotion]}`;

                // Monologue
                const mono = lang==='en' ? (d.monologueEn || d.monologue) : d.monologue;
                document.getElementById('dash-monologue').innerHTML = `‚Äú ${mono} ‚Äù`;
                document.getElementById('dash-emoji').textContent = d.icon;

                // Tags
                const tagContainer = document.getElementById('dash-tags');
                tagContainer.innerHTML = '';
                const tagsList = lang === 'en' ? (d.tagsEn || d.tags) : d.tags;
                const cleanTags = tagsList.map(t => t.replace(/[\[\]]/g, ''));
                cleanTags.forEach(tag => {
                    const el = document.createElement('span');
                    // Updated tag style to match theme
                    el.className = "px-3 py-1 bg-white text-primary font-bold rounded-full text-[10px] border border-secondary/20 font-mono tracking-wide uppercase shadow-sm";
                    el.textContent = tag;
                    tagContainer.appendChild(el);
                });
                
                // Context
                const monoFull = mono;
                document.getElementById('dash-context-text').textContent = lang==='en' ? (monoFull.split('.')[0] + '.') : (monoFull.split('„ÄÇ')[0] + '„ÄÇ');
            }


            // --- PROFILE LIST LOGIC (Original Profile Section Logic Preserved) ---
            const commuterProfiles = [
                {
                    id: 'student',
                    icon: 'student',
                    title: 'Ë∑®Â¢ÉÂ≠¶Á´•',
                    titleEn: 'Cross-border Student',
                    description: 'ÊØèÂ§©Ê∏ÖÊô®ÔºåÂè£Â≤∏Â§ßÂéÖÈáåÊéíÁùÄÊï¥ÈΩêÈòü‰ºçÁöÑÂ∞èÂ≠¶Áîü„ÄÇ2023Âπ¥ÁßãÂ≠£Êñ∞Â≠¶Âπ¥ÔºåËøë3‰∏áÂêçÂ≠¶Á´•Á©øÊ¢≠‰∏§Âú∞„ÄÇ',
                    descriptionEn: 'Every morning, primary school students queue neatly at the border hall. In the fall of 2023, nearly 30,000 students shuttle between the two places.',
                    details: {
                        motivation: 'È¶ôÊ∏ØÊã•ÊúâÂ§öÂÖÉÂåñÁöÑÂõΩÈôÖÊïôËÇ≤‰ΩìÁ≥ªÂíå‰ºòË¥®ÊïôÂ≠¶ËµÑÊ∫êÔºåÂê∏Âºï‰∫ÜÂ§ßÈáèÊ∑±Âú≥ÂÆ∂Â∫≠„ÄÇ',
                        motivationEn: 'Hong Kong has a diversified international education system and high-quality teaching resources, attracting a large number of Shenzhen families.',
                        schedule: '‰∏âÂπ¥Á∫ßÁöÑÂ∞èÊ¢ÅÊØèÂ§©6:00Â∞±ÂæóËµ∑Â∫äÔºåËÉå‰∏ä10Êñ§ÈáçÁöÑ‰π¶ÂåÖ„ÄÇ7:00Áôª‰∏äÊ∏Ø‰∏≠ÊóÖË∑®Â¢ÉÊ†°Â∑¥ÔºåÁªèÊ∑±Âú≥ÊπæÂè£Â≤∏‰∏ìÁî®ÈÄöÈÅìÔºå8:00ÂâçÊäµÊ∏Ø„ÄÇ',
                        scheduleEn: 'Third-grader Xiao Liang gets up at 6:00 every day, carrying a 5kg schoolbag. Boards the cross-border school bus at 7:00, passes through Shenzhen Bay port via special lane, arrives in HK before 8:00.',
                        challenges: [
                            '68%ÁöÑË∑®Â¢ÉÂ≠¶Á´•ÈÄöÂã§Êó∂Èó¥Ë∂ÖËøá1Â∞èÊó∂ÔºåÁù°Áú†‰∏•Èáç‰∏çË∂≥„ÄÇ',
                            'Êó†Ê≥ïÂèÇÂä†È¶ôÊ∏ØÂ≠¶Ê†°ÁöÑËØæÂêéÊ¥ªÂä®Ôºå40%ÁöÑÂ≠¶Á´•Â§±Âéª‰∫ÜÂú®Ê∏ØÁ§æ‰∫§Âúà„ÄÇ',
                            'ÈúÄÈÄÇÂ∫î‰∏§Âú∞‰∏çÂêåÁöÑÊñáÂåñÂíåËÄÉËØïÂà∂Â∫¶ÔºåÊâøÂèóÂèåÈáçÂéãÂäõ„ÄÇ'
                        ],
                        challengesEn: [
                            '68% of cross-border students commute for more than 1 hour, suffering from severe sleep deprivation.',
                            'Unable to participate in after-school activities in HK, 40% of students lost their social circle in HK.',
                            'Need to adapt to different cultures and exam systems in both places, bearing double pressure.'
                        ],
                        thoughts: '"ÊàëÊúÄÂ§ßÁöÑÊÑøÊúõÊòØËÉΩÂèÇÂä†Â≠¶Ê†°ÁöÑË∂≥ÁêÉÈòüÔºå‰ΩÜÊØèÂ§©ÊîæÂ≠¶Â∞±ÂæóËµ∂Â∑¥Â£´..." - Â∞èÊ¢ÅÔºå10Â≤Å',
                        thoughtsEn: '"My biggest wish is to join the school soccer team, but I have to catch the bus every day after school..." - Xiao Liang, 10 years old'
                    }
                },
                {
                    id: 'worker-sz',
                    icon: 'briefcase',
                    title: 'Â±ÖÊ∑±Ê∏Ø‰∫∫',
                    titleEn: 'HK Resident in SZ',
                    description: '‰∫´ÂèóÊ∑±Âú≥ËæÉ‰ΩéÁöÑÁîüÊ¥ªÊàêÊú¨ÂíåÂÆΩÊïûÂ±Ö‰ΩèÁ©∫Èó¥ÔºåÂêåÊó∂ËµöÂèñÈ¶ôÊ∏ØÁöÑÈ´òËñ™ÈÖ¨„ÄÇ',
                    descriptionEn: 'Enjoying lower cost of living and spacious housing in Shenzhen while earning high salary in Hong Kong.',
                    details: {
                        motivation: '44Â≤ÅÁöÑÊ≥¢ÁâπÂú®È¶ôÊ∏ØÈáëËûç‰∏öÂ∑•‰ΩúÔºå‰ΩÜÈ´òÊòÇÁöÑÊàø‰ª∑ËÆ©‰ªñÈÄâÊã©Ê∑±Âú≥„ÄÇ',
                        motivationEn: '44-year-old Potter works in HK finance, but high housing prices made him choose Shenzhen.',
                        schedule: '8:00Ê∑±Âú≥Ëµ∑Â∫äÔºå8:45Âú∞ÈìÅËá≥Á¶èÁî∞Âè£Â≤∏Ôºå9:10Êç¢‰πò‰∏úÈìÅÁ∫øÔºå10:00Êäµ‰∏≠ÁéØ„ÄÇÊôö‰∏ä9:00ÊâçËÉΩÂõûÂà∞Ê∑±Âú≥ÁöÑÂÆ∂„ÄÇ',
                        scheduleEn: 'Wake up at 8:00 in SZ, 8:45 subway to Futian Port, 9:10 East Rail Line, arrive Central at 10:00. Back home in SZ at 9:00 PM.',
                        challenges: [
                            'ÊØèÊó•ÈÄöÂã§Ê∂àËÄóÂ∑®Â§ßÁ≤æÂäõÔºå"ÂèåÂüéÁîüÊ¥ª"ÂÆûÂàôÊòØ"ÂèåÂüéÂ•îÊ≥¢"„ÄÇ',
                            'Âú®ÂÜÖÂú∞Áî≥ËØ∑Ë¥∑Ê¨æ‰ªçÊúâÈó®ÊßõÔºåÁ§æ‰∫§ÂúàË¢´Ââ≤Ë£ÇÂú®Ê≤≥‰∏§Â≤∏„ÄÇ',
                            '‰∏§Âú∞ÂåªÁñó‰ΩìÁ≥ªÂ∑ÆÂºÇÂ§ßÔºåË∑®Â¢ÉÂ∞±ÂåªÊä•ÈîÄ‰ªçÊúâÂ£ÅÂûí„ÄÇ'
                        ],
                        challengesEn: [
                            'Daily commute consumes huge energy, "dual-city life" is actually "dual-city rush".',
                            'Threshold for applying loans in Mainland, social circle split across the river.',
                            'Huge difference in medical systems, barriers in cross-border medical reimbursement.'
                        ],
                        thoughts: '"ËôΩÁÑ∂Â•îÊ≥¢Ôºå‰ΩÜËÉΩÁªôÂÆ∂‰∫∫‰Ωè100Âπ≥Á±≥ÁöÑÂ§ßÊàøÂ≠êÔºåËÄå‰∏çÊòØÈ¶ôÊ∏ØÁöÑÂäèÊàøÔºåÂÄºÂæó„ÄÇ" - Ê≥¢ÁâπÔºå44Â≤Å',
                        thoughtsEn: '"Although rushing, it\'s worth it to give family a 100sqm house instead of a subdivided flat in HK." - Potter, 44 years old'
                    }
                },
                {
                    id: 'worker-hk',
                    icon: 'office-chair',
                    title: 'Â±ÖÊ∏ØÊ∑±‰∫∫',
                    titleEn: 'SZ Worker in HK',
                    description: 'Ë¢´Ê∑±Âú≥Ëì¨ÂãÉÂèëÂ±ïÁöÑÁßëÊäÄ„ÄÅÈáëËûçË°å‰∏öÂê∏ÂºïÔºåËµ¥Ê∑±ÂØªÊ±ÇËÅå‰∏öÊú∫ÈÅáÁöÑÈ¶ôÊ∏ØÈùíÂπ¥„ÄÇ',
                    descriptionEn: 'Hong Kong youth attracted by Shenzhen\'s booming tech and finance industries, seeking career opportunities in SZ.',
                    details: {
                        motivation: '32Â≤ÅÁöÑÊùéÂ∞äÊòéË¢´Ê∑±Âú≥ÁöÑÁßëÂàõÊ∞õÂõ¥Âê∏Âºï„ÄÇ',
                        motivationEn: '32-year-old Li Zunming was attracted by Shenzhen\'s sci-tech innovation atmosphere.',
                        schedule: 'Â±Ö‰∫éÈ¶ôÊ∏ØÂåóÂå∫Ôºå‰πò‰∏úÈìÅÁ∫øËá≥ËêΩÈ©¨Ê¥≤ÔºåËøáÂÖ≥Êç¢‰πòÊ∑±Âú≥Âú∞ÈìÅ4Âè∑Á∫ø„ÄÇ',
                        scheduleEn: 'Lives in North District HK, takes East Rail Line to Lok Ma Chau, crosses border to SZ Metro Line 4.',
                        challenges: [
                            'ÈúÄÈÄÇÂ∫îÂÜÖÂú∞"996"ÁöÑÂ∑•‰ΩúÊñáÂåñÂíå‰∏çÂêåÁöÑËÅåÂú∫ÊΩúËßÑÂàô„ÄÇ',
                            'Ë∑®Â¢ÉÊï∞ÊçÆËÆøÈóÆÂèóÈôêÔºåÊúâÊó∂ÈúÄÁî®VPNËøûÊé•È¶ôÊ∏ØÊúçÂä°„ÄÇ',
                            'Ëñ™ÈÖ¨ËæÉÈ¶ôÊ∏ØÊúâËêΩÂ∑ÆÔºå‰ΩÜÁúãÈáçÊú™Êù•ÁöÑÊôãÂçáÁ©∫Èó¥„ÄÇ'
                        ],
                        challengesEn: [
                            'Need to adapt to Mainland "996" work culture and different workplace unspoken rules.',
                            'Cross-border data access limited, sometimes need VPN to connect HK services.',
                            'Salary gap compared to HK, but values future promotion space.'
                        ],
                        thoughts: '"Ê∑±Âú≥ÁöÑÂàõ‰∏öÁéØÂ¢ÉÊØîÈ¶ôÊ∏ØÊõ¥ÁÅµÊ¥ªÔºåÂπ¥ËΩª‰∫∫ÊúâÊõ¥Â§öÊú∫‰ºöÂÆûÁé∞Ëá™Â∑±ÁöÑÊÉ≥Ê≥ï„ÄÇ" - ÊùéÂ∞äÊòéÔºå32Â≤Å',
                        thoughtsEn: '"Shenzhen\'s startup environment is more flexible than HK, young people have more chances to realize their ideas." - Li Zunming, 32 years old'
                    }
                },
                {
                    id: 'consumer',
                    icon: 'shopping-bag-open',
                    title: 'Âåó‰∏äÁîüÊ¥ªÂÆ¢',
                    titleEn: 'Northbound Consumer',
                    description: '‰ªéÂçïÁ∫ØÁöÑ"Ê∂àË¥πÂåó‰∏ä"ÂçáÁ∫ß‰∏∫"ÁîüÊ¥ªÂåó‰∏ä"Ôºå‰∫´ÂèóÊ∑±Âú≥ÁöÑÈ´òÊÄß‰ª∑ÊØîÊúçÂä°„ÄÇ',
                    descriptionEn: 'Upgraded from "Consumption Northbound" to "Living Northbound", enjoying high cost-performance services in Shenzhen.',
                    details: {
                        motivation: 'ÈôàÁîüÊØèÂë®Êú´Âåó‰∏äÔºö"Ê∑±Âú≥ÁöÑÈ§êÈ•Æ„ÄÅË¥≠Áâ©ÊÄß‰ª∑ÊØîÊûÅÈ´ò„ÄÇÈ¶ôÊ∏ØÈ¢ÑÁ∫¶ÊâãÊúØË¶ÅÊéí‰∏ÄÂπ¥ÔºåÊ∑±Âú≥Á§æÂ∫∑‰∏≠ÂøÉÁúãÁóÖÊó¢Âø´Âèà‰æøÂÆú„ÄÇ"',
                        motivationEn: 'Mr. Chen goes north every weekend: "Shenzhen dining and shopping are extremely cost-effective. HK surgery appointment takes a year, SZ community health center is fast and cheap."',
                        schedule: 'Âë®Êú´Êó©‰∏ä‰∏úÈìÅÁ∫øÊäµÊ∑±Ôºå‰∏äÂçàÁúãÁâô/‰ΩìÊ£ÄÔºå‰∏≠ÂçàÂêÉÈÖ∏ËèúÈ±ºÔºå‰∏ãÂçàÂ±±ÂßÜË∂ÖÂ∏ÇÊâ´Ë¥ßÔºåÊôö‰∏äÊåâÊë©ÂêéËøîÊ∏Ø„ÄÇ',
                        scheduleEn: 'Weekend morning East Rail to SZ, dental/checkup in morning, Sauerkraut Fish for lunch, Sam\'s Club shopping in afternoon, massage then back to HK at night.',
                        challenges: [
                            'ËäÇÂÅáÊó•Âè£Â≤∏‰∫∫ÊµÅÂ∑®Â§ßÔºåÈÄöÂÖ≥ÊéíÈòüÂèØËÉΩË∂Ö2Â∞èÊó∂„ÄÇ',
                            'ÈúÄË¶ÅÁÜüÁªÉ‰ΩøÁî®ÂæÆ‰ø°/ÊîØ‰ªòÂÆù„ÄÅÁæéÂõ¢„ÄÅÊª¥Êª¥Á≠âÂÜÖÂú∞APP„ÄÇ',
                            'ÁÉ≠Èó®È§êÂéÖÈúÄÊèêÂâçÂæà‰πÖÈ¢ÑÁ∫¶Ôºå"ÂèçÂêë‰ª£Ë¥≠"ÈúÄÊ±ÇÂ§ß„ÄÇ'
                        ],
                        challengesEn: [
                            'Huge crowd at port on holidays, crossing queue may exceed 2 hours.',
                            'Need to be proficient in WeChat/Alipay, Meituan, Didi etc.',
                            'Popular restaurants need advance reservation, high demand for "reverse purchasing".'
                        ],
                        thoughts: '"‰∏äÊ¨°Âú®Ê∑±Âú≥Ê¥óÁâôÂè™Ëä±‰∫Ü100ÂùóÔºåÊúçÂä°ËøòÂ•ΩÔºåÂú®È¶ôÊ∏ØÊÉ≥ÈÉΩ‰∏çÊï¢ÊÉ≥„ÄÇ" - ÈôàÁîüÔºå56Â≤Å',
                        thoughtsEn: '"Last time teeth cleaning in SZ cost only 100 RMB with good service, unthinkable in HK." - Mr. Chen, 56 years old'
                    }
                }
            ];

            const profileList = document.getElementById('profile-list');
            const detailView = document.getElementById('detail-view');
            let activeCard = null;

            function renderProfileList() {
                // Clear existing content to prevent duplicates on re-render
                profileList.innerHTML = '';
                
                commuterProfiles.forEach(profile => {
                    const card = document.createElement('div');
                    card.className = 'profile-card glass-card rounded-[20px] p-5 cursor-pointer flex items-center gap-4 border border-transparent hover:border-cyan-200 transition-all';
                    card.dataset.id = profile.id;
                    
                    const isEn = lang === 'en';
                    
                    card.innerHTML = `
                        <div class="w-12 h-12 rounded-full bg-accent text-primary flex items-center justify-center text-2xl shrink-0">
                            <i class="ph-${profile.icon}"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-slate-800 text-base mb-1">${isEn ? (profile.titleEn || profile.title) : profile.title}</h3>
                            <p class="text-xs text-slate-500 line-clamp-2">${isEn ? (profile.descriptionEn || profile.description) : profile.description}</p>
                        </div>
                    `;
                    card.addEventListener('click', () => {
                        renderDetailView(profile.id);
                        if (activeCard) activeCard.classList.remove('active');
                        card.classList.add('active');
                        activeCard = card;
                    });
                    
                    // If this is the active card, keep it active
                    if (activeCard && activeCard.dataset.id === profile.id) {
                        card.classList.add('active');
                        activeCard = card;
                    }
                    
                    profileList.appendChild(card);
                });
            }

            function renderDetailView(id) {
                const profile = commuterProfiles.find(p => p.id === id);
                if (!profile) return;

                const isEn = lang === 'en';

                detailView.innerHTML = `
                    <div class="flex items-center gap-6 mb-8 pb-6 border-b border-slate-100">
                        <div class="w-20 h-20 rounded-full bg-accent text-primary flex items-center justify-center text-4xl shrink-0 shadow-sm">
                            <i class="ph-${profile.icon}"></i>
                        </div>
                        <div>
                            <h2 class="text-3xl font-extrabold text-slate-900 mb-2 tracking-tight">${isEn ? (profile.titleEn || profile.title) : profile.title}</h2>
                            <p class="text-slate-500 text-sm">${isEn ? (profile.descriptionEn || profile.description) : profile.description}</p>
                        </div>
                    </div>
                    <div class="space-y-6">
                        <div>
                            <h3 class="text-xs font-bold text-primary uppercase tracking-widest mb-2">${isEn ? 'Motivation' : '‰∏ªË¶ÅÂä®Êú∫'}</h3>
                            <p class="text-slate-600 text-sm leading-relaxed">${isEn ? (profile.details.motivationEn || profile.details.motivation) : profile.details.motivation}</p>
                        </div>
                        <div>
                            <h3 class="text-xs font-bold text-primary uppercase tracking-widest mb-2">${isEn ? 'Commute Pattern' : 'ÈÄöÂã§Ê®°Âºè'}</h3>
                            <p class="text-slate-600 text-sm leading-relaxed">${isEn ? (profile.details.scheduleEn || profile.details.schedule) : profile.details.schedule}</p>
                        </div>
                        <div>
                            <h3 class="text-xs font-bold text-primary uppercase tracking-widest mb-2">${isEn ? 'Challenges' : 'Èù¢‰∏¥ÁöÑÊåëÊàò'}</h3>
                            <ul class="list-disc pl-5 text-slate-600 text-sm space-y-1">
                                ${(isEn ? (profile.details.challengesEn || profile.details.challenges) : profile.details.challenges).map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                        ${profile.details.thoughts ? `
                        <div class="bg-cyan-50 p-4 rounded-xl border-l-4 border-primary mt-6">
                            <p class="italic text-slate-700 font-serif text-sm">
                                ${isEn ? (profile.details.thoughtsEn || profile.details.thoughts) : profile.details.thoughts}
                            </p>
                        </div>` : ''}
                    </div>
                `;
            }

            // Initial Render
            if (profileList) {
                renderProfileList();
                if (commuterProfiles.length > 0) {
                    renderDetailView(commuterProfiles[0].id);
                    activeCard = profileList.querySelector('.profile-card');
                    if (activeCard) activeCard.classList.add('active');
                }
            }

            // --- DASHBOARD CHARTS (Re-init) ---
            const { c1, c2, c3, c4, c5 } = {c1: '#0E7490', c2: '#06B6D4', c3: '#22D3EE'};

            // 1. Transport Chart (Area)
            const transportCtx = document.getElementById('transportChart')?.getContext('2d');
            if (transportCtx) {
                new Chart(transportCtx, {
                    type: 'line',
                    data: {
                        labels: ['2010', '2012', '2014', '2016', '2018'],
                        datasets: [
                            { label: 'Road', data: [10, 15, 20, 25, 30], backgroundColor: c1, borderColor: c1, fill: 'start', tension: 0.4 },
                            { label: 'Rail', data: [30, 35, 40, 45, 55], backgroundColor: c2, borderColor: c2, fill: '-1', tension: 0.4 },
                            { label: 'HSR', data: [0, 0, 5, 15, 25], backgroundColor: c3, borderColor: c3, fill: '-1', tension: 0.4 }
                        ]
                    },
                    options: { responsive: true, maintainAspectRatio: false, scales: { y: { stacked: true, display: false }, x: { grid: { display: false }, ticks: { font: { family: 'JetBrains Mono' } } } }, plugins: { legend: { display: false } } }
                });
            }

            // 2. Age Chart (Bar)
            const ageCtx = document.getElementById('ageChart')?.getContext('2d');
            if (ageCtx) {
                new Chart(ageCtx, {
                    type: 'bar',
                    data: {
                        labels: ['55+', '45-54', '35-44', '25-34', '18-24'],
                        datasets: [{
                            data: [15, 22, 38, 58, 42],
                            backgroundColor: [c1, c1, c2, c2, c3],
                            borderRadius: 4
                        }]
                    },
                    options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, scales: { x: { display: false }, y: { grid: { display: false }, ticks: { font: { family: 'JetBrains Mono' } } } }, plugins: { legend: { display: false } } }
                });
            }

            // 3. Income Chart (Bar)
            const incomeCtx = document.getElementById('incomeChart')?.getContext('2d');
            if (incomeCtx) {
                new Chart(incomeCtx, {
                    type: 'bar',
                    data: {
                        labels: ['<10k', '10-20k', '20-40k', '40-60k', '>60k'],
                        datasets: [{
                            data: [35, 28, 20, 12, 5],
                            backgroundColor: ['#CBD5E1', '#94A3B8', c3, c2, c1], // Gray to Cyan gradient
                            borderRadius: 4
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, scales: { x: { grid: { display: false }, ticks: { font: { family: 'JetBrains Mono' } } }, y: { display: false } }, plugins: { legend: { display: false } } }
                });
            }

            // 4. Purpose Chart (Doughnut)
            const purposeCtx = document.getElementById('purposeChart')?.getContext('2d');
            if (purposeCtx) {
                new Chart(purposeCtx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Work', 'Study', 'Family', 'Leisure', 'Medical'],
                        datasets: [{
                            data: [45, 18, 15, 12, 10],
                            backgroundColor: [c1, c2, c3, '#6366F1', '#10B981'],
                            borderColor: '#ffffff',
                            borderWidth: 2
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, cutout: '75%', plugins: { legend: { display: false } } }
                });
            }

            // 5. Gender Chart (Line)
            const genderCtx = document.getElementById('genderChart')?.getContext('2d');
            if (genderCtx) {
                new Chart(genderCtx, {
                    type: 'line',
                    data: {
                        labels: ['2010', '2012', '2014', '2016', '2018'],
                        datasets: [{
                            data: [48, 49, 51, 52, 51.5],
                            borderColor: c1,
                            tension: 0.4,
                            pointBackgroundColor: c1,
                            pointRadius: 4,
                            borderWidth: 3
                        }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, scales: { y: { min: 45, max: 55, ticks: { callback: (value) => value + '%', font: { family: 'JetBrains Mono' } } }, x: { display: false } }, plugins: { legend: { display: false } } }
                });
            }

            // Define global update function
            updateContent = (l) => {
                const isEn = l === 'en';
                
                // Re-render Timeline for language switch
                if (typeof renderTimeline === 'function') {
                    renderTimeline();
                }

                // Update Profile Section
                if (typeof renderProfileList === 'function') {
                    renderProfileList();
                    if (activeCard) {
                        renderDetailView(activeCard.dataset.id);
                    } else if (commuterProfiles.length > 0) {
                        renderDetailView(commuterProfiles[0].id);
                    }
                }
            };

            // Initial Render of Timeline
            renderTimeline();
        });
    </script>
</body>
</html>
