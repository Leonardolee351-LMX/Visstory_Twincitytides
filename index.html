<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twin City Tides | A Border Chronicle</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@700;900&family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
 
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        borderGray: '#E5E5E5', /* Lighter border for white theme */
                        narrativeBg: '#FFFFFF', /* White background */
                        accentCyan: '#00997A', /* Darker teal for better contrast on white */
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Noto Serif SC', 'serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                }
            }
        }
    </script>

    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Framer Motion -->
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>

    <style>
        body {
            background-color: #FFFFFF;
            color: #1A1A1A;
            overflow: hidden;
            margin: 0;
            padding: 0;
            cursor: crosshair;
        }

        /* Cinematic Scrolling Animation */
        @keyframes movieCredits {
            from { transform: translateY(100%); }
            to { transform: translateY(-130%); }
        }
        .credits-scroll {
            animation: movieCredits 50s linear infinite;
        }

        /* Hide Scrollbar */
        ::-webkit-scrollbar { width: 0px; background: transparent; }

        .viewport-container {
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        /* Narrative Stepper Styles */
        .nav-line {
            height: 1px;
            background: rgba(0,0,0,0.1); /* Darker line for white bg */
            position: relative;
            flex-grow: 1;
        }
        .nav-dot-container {
            position: relative;
            padding: 15px; 
            margin: -15px;
            cursor: pointer;
            z-index: 60;
        }
        .nav-dot {
            width: 6px;
            height: 6px;
            background: #CCC; /* Lighter dot for inactive state */
            border-radius: 50%;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .nav-dot.active {
            background: #00997A;
            box-shadow: 0 0 12px rgba(0, 153, 122, 0.4);
            transform: scale(1.8);
        }

        @keyframes spin-slow {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
            animation: spin-slow 8s linear infinite;
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { motion, AnimatePresence } = window.Motion;

        const NextButton = ({ onClick, text = "CONTINUE" }) => (
            <button 
                onClick={onClick}
                className="px-8 py-3 border border-black/10 hover:border-accentCyan hover:text-accentCyan text-black/80 transition-all duration-500 font-mono tracking-widest text-[10px] group bg-white/50 backdrop-blur-sm z-50 pointer-events-auto"
            >
                {text} <i className="fas fa-arrow-right ml-2 group-hover:translate-x-2 transition-transform"></i>
            </button>
        );

        const chapters = [
            { 
                id: 0, 
                title: "Title Page", 
                subtitle: "Intro", 
                type: "hero",
                subchapters: [
                    { title: "PREFACE", stepIndex: 1 }
                ]
            },
            { id: 0.5, title: "Dissolving Borders", subtitle: "卷首语（英文）", type: "v2_intro", hiddenInNav: true },
            { 
                id: 1, 
                title: "RECOVERY", 
                subtitle: "Chapter 1\nREBOOTED BOUNDARY", 
                type: "chapter_intro", 
                chapter: "01",
                image: "images/第一章插图.jpg",
                description: [
                    "The long-suppressed border is awakening from a state of <span class='text-highlight'>'Emergency Pause'</span>.",
                    "As gates open, the connection between Shenzhen and Hong Kong tightens. This flow is not merely a traffic recovery, but a deep reboot of <span class='text-highlight'>dual-city life</span>."
                ],
                subchapters: [
                    { title: "1.1 Recovery", url: "1-1.html" },
                    { title: "1.2 Counterflow", url: "1-1.html" }
                ]
            },
            { 
                id: 2, 
                title: "THE FOLDED CITY", 
                subtitle: "Chapter 2\nFOLDED CITY", 
                type: "chapter_intro", 
                chapter: "02",
                image: "images/第二章插图.jpg",
                description: [
                    "The pandemic's end triggered a <span class='text-highlight'>retaliatory rebound</span> in cross-border consumption.",
                    "Amidst surging flows, checkpoints have evolved into smart hubs. Each efficient crossing meets the challenge of massive volume, folding <span class='text-highlight'>physical distance</span> into daily routine."
                ],
                subchapters: [
                    { title: "2.1 Flows", url: "2-0.html" },
                    { title: "2.2 Analysis", url: "2-0.html" },
                    { title: "2.3 Dual City", url: "2-0.html" }
                ]
            },
            { 
                id: 3, 
                title: "THE HUMAN SCALE", 
                subtitle: "Chapter 3\nCONCRETE LIVES", 
                type: "chapter_intro", 
                chapter: "03",
                image: "images/第三章插图.jpg",
                description: [
                    "<span class='text-xl font-bold block mb-2'>Faces of the Border</span>",
                    "In this migration of hundreds of millions, faces are no longer blurred.",
                    "They are migratory birds, ferrymen, stitches suturing two cities. 8 archetypes reflecting 8 survival philosophies."
                ],
                subchapters: [
                    { title: "3.1 Persona", url: "3-2.html" },
                    { title: "3.2 Timeline", url: "3-3.html" },
                    { title: "3.3 Phenomenon", url: "3-3fix.html" }
                ]
            },
            { id: 4, title: "Epilogue", subtitle: "Epilogue", type: "credits" }
        ];

        // 1.5 V2 Intro Page
        const V2IntroPage = ({ onNext }) => (
            <div className="viewport-container text-center px-6 bg-[#F9FAFB]">
                <div className="absolute inset-0 z-0 overflow-hidden opacity-10">
                    <div className="w-full h-full bg-[url('https://images.unsplash.com/photo-1541410945376-a7872f540035?auto=format&fit=crop&q=80&w=2000')] bg-cover bg-center grayscale"></div>
                </div>
                <div className="relative z-10 max-w-4xl mx-auto">
                    <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 1.5 }}>
                        <div className="font-mono text-accentCyan tracking-[0.4em] text-[9px] mb-8 uppercase">2023 - 2025 BORDER CHRONICLE</div>
                        
                        <h1 className="text-5xl md:text-7xl font-black tracking-tighter leading-tight mb-2 text-gray-900 font-serif">
                            Dissolving Borders
                        </h1>
                        <h2 className="text-3xl md:text-5xl font-bold tracking-tight mb-10 text-gray-300 font-serif">
                            Symbiotic Living
                        </h2>
                        
                        <div className="max-w-xl mx-auto mb-16 text-left md:text-center">
                            <div className="h-px w-8 bg-accentCyan mx-auto mb-8 hidden md:block"></div>
                            
                            <div className="space-y-6">
                                <p className="text-xs md:text-sm text-gray-600 font-light leading-loose font-serif">
                                    298 million round trips have delivered the era's answer: Shenzhen and Hong Kong are moving from physical neighbors to emotional and lifestyle 'city-mates'. This momentum, like an irreversible tide, stitches the future of every ordinary person together.
                                </p>
                                <p className="text-xs md:text-sm text-gray-600 font-light leading-loose font-serif">
                                    While accelerated integration brings subtle frictions—efficiency gaps and questions of belonging—these growing pains will gradually smooth out as the "One-Hour Living Circle" matures.
                                </p>
                            </div>

                            <div className="mt-8 pt-8 border-t border-gray-200/60">
                                <p className="text-accentCyan/90 font-serif italic text-xs md:text-sm leading-relaxed">
                                    "The border transforms from a dividing line into a vibrant confluence.<br/>
                                    Every crossing measures the arrival of a borderless era.<br/>
                                    In the future, there is no 'cross-border', only 'living'."
                                </p>
                            </div>
                        </div>

                        <button 
                            onClick={onNext}
                            className="px-6 py-2 border border-black/10 hover:border-accentCyan hover:text-accentCyan transition-all duration-500 font-mono tracking-widest text-[9px] group text-gray-800"
                        >
                            ENTERING THE BORDER <i className="fas fa-arrow-right ml-2 group-hover:translate-x-2 transition-transform"></i>
                        </button>
                    </motion.div>
                </div>
            </div>
        );

        // 1. Hero Page (Modified for White Mode)
        const HeroPage = ({ onNext }) => (
            <div className="viewport-container text-center px-6">
                <div className="absolute inset-0 z-0 overflow-hidden opacity-10">
                    <div className="w-full h-full bg-[url('https://images.unsplash.com/photo-1541410945376-a7872f540035?auto=format&fit=crop&q=80&w=2000')] bg-cover bg-center grayscale"></div>
                </div>
                <div className="relative z-10">
                    <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 1.5 }}>
                        <div className="font-mono text-accentCyan tracking-[0.4em] text-xs mb-6 uppercase">2023 - 2025 BORDER CHRONICLE</div>
                        <h1 className="text-5xl md:text-8xl font-black tracking-tighter leading-none mb-4 text-black">From Crossing<br/>to Commuting</h1>
                        <h2 className="text-xl md:text-3xl font-serif text-black/60 tracking-[0.3em] mb-12 uppercase">How SZ-HK Border Becomes Everyday Life</h2>
                        <button 
                            onClick={onNext}
                            className="px-8 py-3 border border-black/10 hover:border-accentCyan hover:text-accentCyan text-black/80 transition-all duration-500 font-mono tracking-widest text-[10px] group"
                        >
                            ENTERING THE BORDER <i className="fas fa-arrow-right ml-2 group-hover:translate-x-2 transition-transform"></i>
                        </button>
                    </motion.div>
                </div>
            </div>
        );

        // 2. Chapter Intro (Modified for White Mode)
        const FloatingCard = ({ title, titleEn, quote, x, y, delay }) => {
            const [isActive, setIsActive] = useState(false);

            return (
                <motion.div 
                    drag
                    dragConstraints={{ left: -100, right: 100, top: -100, bottom: 100 }}
                    onDragStart={() => setIsActive(true)}
                    onDragEnd={() => setIsActive(false)}
                    onHoverStart={() => setIsActive(true)}
                    onHoverEnd={() => setIsActive(false)}
                    initial={{ opacity: 0, y: 20 }}
                    animate={{ 
                        opacity: 1, 
                        y: [0, -10, 0],
                        zIndex: isActive ? 50 : 0
                    }}
                    transition={{ 
                        opacity: { delay: delay, duration: 0.8 },
                        y: { repeat: Infinity, duration: 3 + Math.random() * 2, ease: "easeInOut", delay: delay },
                        zIndex: { duration: 0 }
                    }}
                    style={{ left: x, top: y }}
                    className="absolute hidden md:flex flex-col p-4 bg-white/40 backdrop-blur-sm border border-white/60 rounded-xl shadow-sm w-48 cursor-grab active:cursor-grabbing group hover:bg-white/60 transition-colors duration-300"
                >
                    <div className="w-8 h-8 rounded-full bg-accentCyan/10 mb-2 flex items-center justify-center pointer-events-none">
                        <i className="fas fa-user text-accentCyan text-xs"></i>
                    </div>
                    <div className="font-bold text-slate-800 text-xs pointer-events-none">{title}</div>
                    <div className="text-[10px] text-slate-500 font-mono uppercase pointer-events-none mb-1">{titleEn}</div>
                    
                    {/* Opinion Tooltip */}
                    <AnimatePresence>
                        {isActive && (
                            <motion.div
                                initial={{ opacity: 0, scale: 0.9, y: 10 }}
                                animate={{ opacity: 1, scale: 1, y: 0 }}
                                exit={{ opacity: 0, scale: 0.9, y: 5 }}
                                className="absolute top-full left-0 mt-2 w-56 p-3 bg-white/90 backdrop-blur-md rounded-lg shadow-xl border border-accentCyan/20 z-50 pointer-events-none"
                            >
                                <div className="absolute -top-1 left-6 w-2 h-2 bg-white/90 transform rotate-45 border-t border-l border-accentCyan/20"></div>
                                <p className="text-[10px] leading-relaxed text-slate-600 font-serif italic">
                                    "{quote}"
                                </p>
                            </motion.div>
                        )}
                    </AnimatePresence>
                </motion.div>
            );
        };

        const ChapterIntro = ({ data, onNext }) => {
            const isFaces = data.id === 3; // Identified by ID for stability
            const paragraphs = data.description || [];
            
            const cards = [
                { 
                    title: "跨境学童", 
                    titleEn: "Cross-border Student", 
                    x: "10%", 
                    y: "20%",
                    quote: "The Shenzhen-Hong Kong border is like a magic door to me. One side holds the delicious warmth of home cooking; the other, the strict discipline of school."
                },
                { 
                    title: "深港通勤族", 
                    titleEn: "SZ-HK Commuters", 
                    x: "75%", 
                    y: "15%",
                    quote: "The border defines my existence. It's a calculated trade-off between high income and living costs. Sometimes I feel like a pendulum."
                },
                { 
                    title: "周末特种兵", 
                    titleEn: "Weekend Raiders", 
                    x: "80%", 
                    y: "60%",
                    quote: "As a consumer, the border is the line of 'cost-performance ratio'. I hope payment and logistics will be fully integrated soon."
                },
                { 
                    title: "北上安老长者", 
                    titleEn: "Elderly Moving North", 
                    x: "15%", 
                    y: "70%",
                    quote: "Retirement in the Greater Bay Area means dignity. My pension stretches further here—spacious gardens and attentive care that were impossible dreams in Hong Kong."
                },
                { 
                    title: "留学硕博通勤者", 
                    titleEn: "Postgrad Commuters", 
                    x: "60%", 
                    y: "80%",
                    quote: "The border is like a filter. It filters out Shenzhen's noise so I can study, and HK's stress so I can rest. But it also blurs my sense of belonging."
                },
                { 
                    title: "远程协作人", 
                    titleEn: "Remote Collaborators", 
                    x: "20%", 
                    y: "40%",
                    quote: "My office is in the cloud, my home is in Shenzhen. The border is just a checkpoint for client meetings, not a barrier to my daily life."
                },
                { 
                    title: "商务精英", 
                    titleEn: "Business Elite", 
                    x: "50%", 
                    y: "10%",
                    quote: "Time is the only currency that matters. The high-speed rail and E-channel make the border invisible, turning two cities into one giant business district."
                },
                { 
                    title: "生活探索者", 
                    titleEn: "Life Explorer", 
                    x: "85%", 
                    y: "35%",
                    quote: "I don't belong to one city. I belong to the flow. Shenzhen's tech vibrancy and Hong Kong's cultural depth—why choose when I can have both?"
                }
            ];

            return (
                <div className="viewport-container px-12 md:px-32 justify-start relative overflow-hidden bg-white">
                    
                    {/* Background Image Container on the RIGHT 
                        使用 clip-path 替代 skew，确保斜线从顶到底绝对笔直
                    */}
                    <div 
                        className="absolute right-0 top-0 h-full w-[70%] z-0" 
                        style={{ clipPath: "polygon(20% 0, 100% 0, 100% 100%, 0% 100%)" }}
                    >
                        {/* Image */}
                        <img 
                            src={data.image} 
                            alt={data.title}
                            className="absolute inset-0 w-full h-full object-cover grayscale-[5%] opacity-100"
                        />
                        
                        {/* Overlays for texture and text readability */}
                        <div className="absolute inset-0 bg-accentCyan/5 mix-blend-multiply pointer-events-none"></div>
                        <div className="absolute inset-0 bg-gradient-to-l from-transparent to-white/10 pointer-events-none"></div>
                    </div>
                    
                    {/* Floating Cards for Faces Chapter */}
                    {isFaces && cards.map((card, i) => (
                        <FloatingCard key={i} {...card} delay={0.5 + i * 0.1} />
                    ))}

                    <div className="relative z-10 max-w-4xl text-left">
                        <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ duration: 1 }}>
                            <div className="flex items-center gap-4 mb-8">
                                <span className="text-3xl font-mono text-gray-300">{data.chapter}</span>
                                <div className="h-px w-12 bg-accentCyan"></div>
                            </div>
                            
                            <div className="mb-8">
                                {data.subtitle && (
                                    <div className="text-accentCyan font-mono tracking-[0.3em] uppercase text-[9px] mb-3">
                                        {data.subtitle}
                                    </div>
                                )}
                                <h2 className="text-4xl md:text-6xl font-sans font-black tracking-tight text-[#00997A] uppercase leading-[0.9]">
                                    {data.title}
                                </h2>
                            </div>
                            
                            {/* Standardized layout for all chapters including Faces */}
                            <div className="max-w-md border-l border-accentCyan/20 pl-6 ml-1 bg-white/80 backdrop-blur-sm p-4 rounded-r-lg md:p-6 md:pl-8 mb-12 shadow-sm"> 
                                {paragraphs.map((para, index) => (
                                    <p 
                                        key={index} 
                                        className="mb-5 last:mb-0 leading-loose text-gray-500 font-light font-serif text-xs md:text-sm text-justify"
                                        dangerouslySetInnerHTML={{__html: para}}
                                    />
                                ))}
                            </div>
                            
                            <NextButton onClick={() => {
                        if (data.id === 1) window.location.href = '1-1.html';
                        else if (data.id === 2) window.location.href = '2-0.html';
                        else if (data.id === 3) window.location.href = '3-2.html';
                        else onNext();
                    }} text="ENTER CHAPTER" />
                        </motion.div>
                    </div>
                </div>
            );
        };

        // 3. Data Viz (Integrated 1-1.html)
        const DataVizPage = ({ onNext }) => (
            <div className="viewport-container w-full h-full relative">
                <iframe 
                    src="1-1.html" 
                    className="w-full h-full border-0" 
                    title="The Resurgence"
                />
                <div className="absolute bottom-8 right-8 z-50">
                    <NextButton onClick={onNext} text="NEXT CHAPTER" />
                </div>
            </div>
        );

        // 4. Split View (Integrated 2-0.html)
        const SplitViewPage = ({ onNext }) => (
            <div className="viewport-container w-full h-full relative">
                <iframe 
                    src="2-0.html" 
                    className="w-full h-full border-0" 
                    title="Folding Time Analysis"
                />
                <div className="absolute bottom-8 right-8 z-50">
                    <NextButton onClick={onNext} text="NEXT CHAPTER" />
                </div>
            </div>
        );

        // 5. Persona Grid (Integrated Navigation for People)
        const PersonaGrid = () => {
            const [activePage, setActivePage] = useState(null);

            const pages = [
                { id: '3-1', title: 'Cross-Temporal', subtitle: 'Analysis', url: '3-1.html', desc: 'Space-time evolution of border crossings.' },
                { id: '3-2', title: 'Persona', subtitle: 'Profiles', url: '3-2.html', desc: 'Individual stories from the commuter tide.' },
                { id: '3-3', title: 'Timeline', subtitle: 'Cross-Border', url: '3-3.html', desc: 'A day in the life of the twin cities.' },
                { id: '4-1', title: 'Future', subtitle: 'Questions', url: '4-1future_question.html', desc: 'Emerging issues and future outlooks.' },
            ];

            return (
                <div className="viewport-container w-full h-full relative">
                    <AnimatePresence mode="wait">
                        {activePage ? (
                            <motion.div 
                                key="detail"
                                initial={{ opacity: 0, scale: 0.95 }}
                                animate={{ opacity: 1, scale: 1 }}
                                exit={{ opacity: 0, scale: 0.95 }}
                                className="w-full h-full bg-white relative"
                            >
                                <button 
                                    onClick={() => setActivePage(null)}
                                    className="absolute top-4 right-4 z-50 px-4 py-2 bg-white/90 backdrop-blur border border-black/10 rounded-full text-[10px] font-mono uppercase tracking-widest hover:bg-black/5 hover:text-accentCyan transition-colors shadow-sm"
                                >
                                    <i className="ph ph-x mr-2"></i>Close View
                                </button>
                                <iframe src={activePage} className="w-full h-full border-0" title="Detail View" />
                            </motion.div>
                        ) : (
                            <motion.div 
                                key="grid"
                                initial={{ opacity: 0 }}
                                animate={{ opacity: 1 }}
                                exit={{ opacity: 0 }}
                                className="w-full h-full flex items-center justify-center p-8 md:p-20"
                            >
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-5xl">
                                    {pages.map((page, index) => (
                                        <div 
                                            key={page.id}
                                            onClick={() => setActivePage(page.url)}
                                            className="group relative overflow-hidden bg-white border border-black/5 hover:border-accentCyan/50 transition-all duration-500 cursor-pointer h-64 flex flex-col justify-between p-8 hover:shadow-xl hover:-translate-y-1"
                                        >
                                            <div className="absolute top-0 right-0 w-24 h-24 bg-accentCyan/5 rounded-bl-full -mr-8 -mt-8 transition-transform group-hover:scale-150 duration-700"></div>
                                            
                                            <div>
                                                <div className="font-mono text-[10px] text-black/40 tracking-widest uppercase mb-3">{page.subtitle}</div>
                                                <h3 className="font-serif text-3xl text-black/80 group-hover:text-accentCyan transition-colors duration-300">{page.title}</h3>
                                            </div>
                                            
                                            <div className="flex justify-between items-end">
                                                <p className="text-xs text-black/50 max-w-[70%] font-sans leading-relaxed">{page.desc}</p>
                                                <div className="w-10 h-10 rounded-full border border-black/10 flex items-center justify-center group-hover:bg-accentCyan group-hover:text-white group-hover:border-transparent transition-all duration-300">
                                                    <i className="ph ph-arrow-right"></i>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </motion.div>
                        )}
                    </AnimatePresence>
                </div>
            );
        };

        // 6. Epilogue (Modified for Static Text)
        const CreditsPage = () => (
            <div className="viewport-container bg-white flex items-center justify-center">
                <div className="max-w-3xl px-8 text-center">
                    <div className="text-accentCyan font-mono text-[10px] tracking-[0.5em] mb-8 uppercase">Epilogue</div>
                    <h2 className="text-4xl md:text-5xl font-serif mb-12 tracking-widest uppercase text-black">
                        <span data-zh="边界消融，生活共生" data-en="Border Dissolution, Life Symbiosis">Border Dissolution, Life Symbiosis</span>
                    </h2>
                    
                    <div className="space-y-8 text-black/70 font-serif leading-loose text-lg md:text-xl">
                        <p>
                            <span data-zh="2.98 亿次的往返，已经给出了时代的答案：边界逐渐成为双向交流的窗口，疫情后的深港两地正从物理上的“邻居”，真正走向情感与生活上的“同城”。这种融合的势头，如同不可逆转的潮汐，将每一个普通人的未来紧密缝合。" 
                                  data-en="298 million crossings have delivered the era's verdict: the border is evolving from a barrier into a window for two-way exchange. Post-pandemic, Shenzhen and Hong Kong are transitioning from physical 'neighbors' to genuine 'city-mates' in emotion and lifestyle. This integration, like an irreversible tide, stitches together the future of every individual.">
                                298 million crossings have delivered the era's verdict: the border is evolving from a barrier into a window for two-way exchange. Post-pandemic, Shenzhen and Hong Kong are transitioning from physical "neighbors" to genuine "city-mates" in emotion and lifestyle. This integration, like an irreversible tide, stitches together the future of every individual.
                            </span>
                        </p>
                        <p>
                            <span data-zh="虽然在加速融合的过程中，我们仍需面对链路效率与生活归属感等细微的褶皱，还要跨越一大片的荒野。但这些成长的阵痛，终将在“一小时生活圈”的完善中逐渐抚平。这里的每一步往返，都在丈量一个无界时代的到来。 未来，不再有“跨境”，只有“生活”。" 
                                  data-en="While we still face wrinkles in efficiency and belonging—a wilderness yet to be crossed—these growing pains will eventually smooth out within the perfecting 'One Hour Living Circle.' Every step back and forth measures the arrival of a borderless era. In the future, there will be no 'cross-border,' only 'living.'">
                                While we still face wrinkles in efficiency and belonging—a wilderness yet to be crossed—these growing pains will eventually smooth out within the perfecting "One Hour Living Circle." Every step back and forth measures the arrival of a borderless era. In the future, there will be no "cross-border," only "living."
                            </span>
                        </p>
                    </div>
                </div>
            </div>
        );

        // --- Global Navigation Component ---
        const GlobalNav = ({ chapters, currentStep, onNavigate }) => {
            // Filter out hidden chapters but keep track of original index for navigation
            const navItems = chapters
                .map((chapter, index) => ({ ...chapter, originalIndex: index }))
                .filter(chapter => !chapter.hiddenInNav);

            // Determine if a nav item is active (either it's the current step, or the current step is a hidden child of it)
            // Logic: A nav item is active if currentStep matches its originalIndex, 
            // OR if currentStep is one of its subchapters' stepIndex.
            const isItemActive = (item) => {
                if (currentStep === item.originalIndex) return true;
                if (item.subchapters && item.subchapters.some(sub => sub.stepIndex === currentStep)) return true;
                return false;
            };

            return (
                <nav className="fixed bottom-0 left-0 w-full z-[100] flex justify-center pb-12 pt-20 bg-gradient-to-t from-white via-white/90 to-transparent pointer-events-none">
                    <div className="flex items-end gap-12 md:gap-24 pointer-events-auto">
                        {navItems.map((chapter) => {
                            const active = isItemActive(chapter);
                            
                            return (
                                <div key={chapter.id} className="relative group flex flex-col items-center">
                                    {/* Main Click Area (Label + Dot) */}
                                    <div 
                                        className="flex flex-col items-center cursor-pointer"
                                        onClick={(e) => {
                                            e.stopPropagation();
                                            onNavigate(chapter.originalIndex);
                                        }}
                                    >
                                        {/* Label */}
                                        <div className={`text-[10px] font-mono tracking-widest uppercase transition-colors duration-300 whitespace-pre-line text-center leading-tight ${active ? 'text-accentCyan font-bold' : 'text-black/40 group-hover:text-black/80'}`}>
                                            {chapter.subtitle}
                                        </div>
                                        
                                        {/* Dot */}
                                        <div className={`w-2 h-2 rounded-full mt-3 transition-all duration-300 ${active ? 'bg-accentCyan scale-125' : 'bg-black/20 group-hover:bg-black/40'}`}></div>
                                    </div>

                                    {/* Hover Line & Sub-chapters (Upward Y-axis) */}
                                    {chapter.subchapters && (
                                        <div className="absolute bottom-8 left-1/2 -translate-x-1/2 flex flex-col-reverse items-center opacity-0 group-hover:opacity-100 transition-opacity duration-300 pointer-events-none group-hover:pointer-events-auto">
                                            {/* The Line */}
                                            <div className="w-px h-32 bg-accentCyan/30 origin-bottom scale-y-0 group-hover:scale-y-100 transition-transform duration-500 ease-out delay-75"></div>
                                            
                                            {/* Sub-items Container - positioned absolutely along the line */}
                                            <div 
                                                className="absolute bottom-0 w-48 h-32 flex flex-col-reverse justify-around items-center py-2"
                                                onClick={(e) => e.stopPropagation()}
                                            >
                                                {chapter.subchapters.map((sub, subIndex) => (
                                                    <div 
                                                        key={subIndex} 
                                                        className="relative flex items-center justify-center w-full transform translate-y-4 opacity-0 group-hover:translate-y-0 group-hover:opacity-100 transition-all duration-300 cursor-pointer"
                                                        style={{ transitionDelay: `${150 + subIndex * 100}ms` }}
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            if (sub.stepIndex !== undefined) {
                                                                onNavigate(sub.stepIndex);
                                                            } else {
                                                                window.location.href = sub.url;
                                                            }
                                                        }}
                                                    >
                                                        {/* Label */}
                                                        <div className={`bg-white/95 backdrop-blur px-3 py-1 border rounded shadow-sm text-[10px] font-medium transition-colors hover:scale-105 whitespace-nowrap ${currentStep === sub.stepIndex ? 'text-accentCyan border-accentCyan/30' : 'text-black/60 border-black/5 hover:text-accentCyan hover:border-accentCyan/30'}`}>
                                                            {sub.title}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            );
                        })}
                    </div>
                </nav>
            );
        };

        // --- Main App Component ---

        const App = () => {
            const [step, setStep] = useState(0);
            const [direction, setDirection] = useState(1);

            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                const stepParam = params.get('step');
                if (stepParam !== null) {
                    const targetStep = parseInt(stepParam, 10);
                    if (!isNaN(targetStep) && targetStep >= 0 && targetStep < chapters.length) {
                        setStep(targetStep);
                    }
                }
            }, []);

            const goToStep = (target) => {
                if (target === step) return;
                setDirection(target > step ? 1 : -1);
                setStep(target);
            };

            const next = () => { if (step < chapters.length - 1) goToStep(step + 1); };
            const prev = () => { if (step > 0) goToStep(step - 1); };

            useEffect(() => {
                const handleKeyDown = (e) => {
                    if (e.key === 'ArrowRight' || e.key === 'ArrowDown') next();
                    if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') prev();
                };
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [step]);

            return (
                <div className="w-screen h-screen bg-narrativeBg select-none overflow-hidden flex flex-col relative">
                    
                    {/* Global Navigation */}
                    <GlobalNav chapters={chapters} currentStep={step} onNavigate={goToStep} />

                    {/* Top Progress Indicator (Modified for White Mode) */}
                    <header className="fixed top-10 left-10 z-[100] pointer-events-none">
                        <div className="font-mono text-[9px] tracking-[0.6em] text-black/40 uppercase">
                            INDEX {step.toString().padStart(2, '0')} / {chapters[step].title.toUpperCase()}
                        </div>
                    </header>

                    {/* Content Layer */}
                    <main className="flex-1 relative z-10">
                        <AnimatePresence mode="wait" custom={direction}>
                            <motion.div
                                key={step}
                                custom={direction}
                                initial={{ opacity: 0, x: direction * 40 }}
                                animate={{ opacity: 1, x: 0 }}
                                exit={{ opacity: 0, x: -direction * 40 }}
                                transition={{ duration: 0.9, ease: [0.16, 1, 0.3, 1] }}
                                className="absolute inset-0"
                            >
                                {step === 0 && <HeroPage onNext={next} />}
                                {chapters[step].type === "v2_intro" && <V2IntroPage onNext={next} />}
                                {chapters[step].type === "chapter_intro" && <ChapterIntro data={chapters[step]} />}
                                {chapters[step].type === "data_viz" && <DataVizPage />}
                                {chapters[step].type === "split_view" && <SplitViewPage />}
                                {chapters[step].type === "persona_grid" && <PersonaGrid />}
                                {chapters[step].type === "credits" && <CreditsPage />}
                            </motion.div>
                        </AnimatePresence>
                    </main>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>